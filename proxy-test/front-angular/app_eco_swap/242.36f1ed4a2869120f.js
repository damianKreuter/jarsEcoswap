"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[242],{6242:(k,g,e)=>{e.r(g),e.d(g,{PublicacionesModule:()=>X});var d=e(4755),u=e(1531),v=e(8675),C=e(4004),P=e(5226),x=e.n(P),o=e(2223),T=e(4377),l=e(9401),_=e(4893),M=e(3073),O=e(2777),Z=e(4666),f=e(9114),A=e(430),L=e(9609),I=e(1728),F=e(787),J=e(1217),h=e(8995),p=e(6996),y=e(3649),s=e(3148),S=e(7876),U=e(4984),N=e(9229);const Q=["localidadInput"];function w(t,c){if(1&t){const i=o.EpF();o.TgZ(0,"mat-chip-row",31),o.NdJ("removed",function(){const r=o.CHM(i).$implicit,m=o.oxw(3);return o.KtG(m.remove(r))}),o._uU(1),o.TgZ(2,"button",32)(3,"mat-icon"),o._uU(4,"cancel"),o.qZA()()()}if(2&t){const i=c.$implicit;o.xp6(1),o.hij(" ",i," "),o.xp6(1),o.uIk("aria-label","eliminar "+i)}}function Y(t,c){if(1&t&&(o.TgZ(0,"mat-option",33),o._uU(1),o.qZA()),2&t){const i=c.$implicit;o.Q6J("value",i),o.xp6(1),o.hij(" ",i," ")}}function G(t,c){if(1&t&&(o.TgZ(0,"mat-option",33),o._uU(1),o.qZA()),2&t){const i=c.$implicit;o.Q6J("value",i.nombre),o.xp6(1),o.hij(" ",i.descripcion," ")}}function j(t,c){if(1&t){const i=o.EpF();o.TgZ(0,"form",16)(1,"mat-form-field",17)(2,"mat-label"),o._uU(3,"Localidades"),o.qZA(),o.TgZ(4,"mat-chip-grid",18,19),o.YNc(6,w,5,2,"mat-chip-row",20),o.TgZ(7,"input",21,22),o.NdJ("matChipInputTokenEnd",function(a){o.CHM(i);const r=o.oxw(2);return o.KtG(r.add(a))}),o.qZA()(),o.TgZ(9,"mat-autocomplete",23,24),o.NdJ("optionSelected",function(a){o.CHM(i);const r=o.oxw(2);return o.KtG(r.selected(a))}),o.YNc(11,Y,2,2,"mat-option",25),o.ALo(12,"async"),o.qZA()(),o.TgZ(13,"mat-form-field",26)(14,"mat-label"),o._uU(15,"Tipo del Producto"),o.qZA(),o.TgZ(16,"mat-select",27),o.YNc(17,G,2,2,"mat-option",25),o.qZA()(),o.TgZ(18,"div",28)(19,"button",29),o.NdJ("click",function(){o.CHM(i);const a=o.oxw(2);return o.KtG(a.filtrarPublicaciones())}),o._uU(20,"FILTRAR"),o.qZA(),o.TgZ(21,"button",30),o.NdJ("click",function(){o.CHM(i);const a=o.oxw(2);return o.KtG(a.limpiarFiltros())}),o._uU(22,"LIMPIAR"),o.qZA()()()}if(2&t){const i=o.MAs(5),n=o.MAs(10),a=o.oxw(2);o.Q6J("formGroup",a.formFiltros),o.xp6(6),o.Q6J("ngForOf",a.localidades),o.xp6(1),o.Q6J("matChipInputFor",i)("matAutocomplete",n),o.xp6(4),o.Q6J("ngForOf",o.lcZ(12,6,a.filteredLocalidades)),o.xp6(6),o.Q6J("ngForOf",a.tipos_productos)}}function H(t,c){1&t&&(o.TgZ(0,"div",7,8)(2,"div",9,10)(4,"h2",11)(5,"button",12)(6,"mat-icon"),o._uU(7,"tune"),o.qZA(),o.TgZ(8,"span",13),o._uU(9,"Filtros"),o.qZA()()(),o.TgZ(10,"div",14)(11,"div",15),o.YNc(12,j,23,8,"ng-template"),o.qZA()()()()),2&t&&(o.xp6(2),o.Q6J("collapsed",!1))}function $(t,c){1&t&&(o.TgZ(0,"div",28),o._uU(1,"No hay publicaciones para mostrar"),o.qZA())}function B(t,c){if(1&t&&o._UZ(0,"app-deck",38),2&t){const i=o.oxw(2);o.Q6J("cardList",i.publicacionesCardList)}}function E(t,c){if(1&t&&(o.TgZ(0,"div",34),o._UZ(1,"app-spinner",35),o.YNc(2,$,2,0,"div",36),o.YNc(3,B,1,1,"app-deck",37),o.qZA()),2&t){const i=o.oxw();o.xp6(1),o.Q6J("loading",i.loading),o.xp6(1),o.Q6J("ngIf",0==i.publicacionesCardList.length),o.xp6(1),o.Q6J("ngIf",i.publicacionesCardList.length>0)}}const R=[{path:"",component:(()=>{class t{constructor(i,n,a,r,m,W,q){this.router=i,this.auth=n,this.fb=a,this.productosService=r,this.showErrorService=m,this.truequesService=W,this.comprasService=q,this.origin="all",this.tipos_productos=[],this.loading=!1,this.publicacionesToShow=[],this.localidades=[],this.allLocalidades=[],this.publicacionesCardList=[],this.formFiltros=a.group({fundacion:[""],localidad:[""],tipoProducto:[""]}),"/mis-publicaciones"==i.url&&(this.origin="myPublicaciones"),"/mis-compras"==i.url&&(this.origin="myCompras"),this.filteredLocalidades=this.formFiltros.controls.localidad.valueChanges.pipe((0,v.O)(""),(0,C.U)(b=>b?this._filterLocalidad(b):this.allLocalidades.slice())),this.getTiposProductos(),this.getLocalidades(),this.filtrarPublicaciones()}addPublicacion(){this.auth.isUserLoggedIn?this.router.navigate(["form-publicacion"]):x().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder crear una publicaci\xf3n, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:i})=>{i&&this.router.navigate(["login"])})}getTiposProductos(){this.productosService.getTiposProductos().subscribe({next:i=>this.tipos_productos=i,error:i=>console.error("error",i)})}filtrarPublicaciones(){if("all"==this.origin){this.filtros={};const i=this.formFiltros.controls.tipoProducto.value;this.localidades.length>0&&(this.filtros.localidades=this.localidades),i&&(this.filtros.tipoProducto=i),this.truequesService.getPublicaciones(this.filtros).subscribe({next:n=>{console.log(n),this.publicacionesToShow=n,this.publicacionesToShow.map(a=>{a.parsedImagenes=a.imagenes.split("|")})},complete:()=>this.generateCardList()})}else"myPublicaciones"==this.origin?this.truequesService.getMisPublicaciones().subscribe({next:i=>{console.log(i),this.publicacionesToShow=i,this.publicacionesToShow.map(n=>{n.parsedImagenes=n.imagenes.split("|")})},complete:()=>this.generateCardList()}):this.comprasService.getMyCompras().subscribe({next:i=>{console.log(i);for(const n of i)this.publicacionesToShow.push(n.publicacionDTO);this.publicacionesToShow.map(n=>{n.parsedImagenes=n.imagenes.split("|")})},complete:()=>this.generateCardList()})}generateCardList(){this.publicacionesCardList.splice(0);for(const i of this.publicacionesToShow)this.publicacionesCardList.push({id:i.idPublicacion,imagen:i.parsedImagenes?i.parsedImagenes[0]:"no_image",titulo:i.titulo,valorPrincipal:`$${i.valorTruequeMin} - $${i.valorTruequeMax}`,valorSecundario:i.precioVenta?`$${i.precioVenta}`:void 0,fecha:i.fechaPublicacion,usuario:{imagen:"assets/perfiles/perfiles-17.jpg",nombre:i.particularDTO.nombre+" "+i.particularDTO.apellido,puntaje:i.particularDTO.puntaje,localidad:i.particularDTO.direcciones[0].localidad},action:"access",buttons:[],estado:"myPublicaciones"==this.origin?i.estadoPublicacion:void 0,codigo:"Publicaci\xf3n"})}limpiarFiltros(){this.formFiltros.reset(),this.localidades=[],this.filtrarPublicaciones()}getLocalidades(){fetch("https://apis.datos.gob.ar/georef/api/localidades?orden=id&provincia=02&max=50&campos=nombre").then(n=>n.json()).then(n=>{for(const a of n.localidades)this.allLocalidades.push(a.nombre)}).catch(n=>console.error(n))}add(i){const n=(i.value||"").trim();n&&this.allLocalidades.some(a=>a.toUpperCase()==n.toUpperCase())&&this.localidades.push(n),i.chipInput.clear(),this.formFiltros.controls.localidad.setValue(null)}remove(i){const n=this.localidades.indexOf(i);n>=0&&this.localidades.splice(n,1)}selected(i){this.localidades.push(i.option.viewValue),this.localidadInput.nativeElement.value="",this.formFiltros.controls.localidad.setValue(null)}_filterLocalidad(i){const n=i.toLowerCase();return this.allLocalidades.filter(a=>a.toLowerCase().includes(n))}}return t.\u0275fac=function(i){return new(i||t)(o.Y36(u.F0),o.Y36(T.e),o.Y36(l.qu),o.Y36(_.k),o.Y36(M.x),o.Y36(O.x),o.Y36(Z.K))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-trueque"]],viewQuery:function(i,n){if(1&i&&o.Gf(Q,5),2&i){let a;o.iGM(a=o.CRH())&&(n.localidadInput=a.first)}},decls:9,vars:3,consts:[[3,"title"],["id","main-publicaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","",4,"ngIf"],["class","row",4,"ngIf"],[1,"floating-button-container"],["mat-fab","","color","primary","aria-label","Agregar Publicaci\xf3n","matTooltip","Agregar Publicaci\xf3n","matTooltipPosition","before",3,"click"],["ngbAccordion",""],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["id","form-filtros",3,"formGroup"],["appearance","outline",1,"example-chip-list"],["aria-label","Localidad"],["chipGrid",""],[3,"removed",4,"ngFor","ngForOf"],["placeholder","Localidad...","formControlName","localidad","matInput","",3,"matChipInputFor","matAutocomplete","matChipInputTokenEnd"],["localidadInput",""],[3,"optionSelected"],["autoLocalidad","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline"],["formControlName","tipoProducto","panelClass","example-panel"],[2,"text-align","center"],["mat-fab","","extended","","color","primary",3,"click"],["mat-fab","","extended","",2,"background-color","white",3,"click"],[3,"removed"],["matChipRemove",""],[3,"value"],[1,"row"],[3,"loading"],["style","text-align: center;",4,"ngIf"],["app","publicaciones",3,"cardList",4,"ngIf"],["app","publicaciones",3,"cardList"]],template:function(i,n){1&i&&(o._UZ(0,"app-header",0),o.TgZ(1,"div",1)(2,"div",2),o.YNc(3,H,13,1,"div",3),o.qZA(),o.YNc(4,E,4,3,"div",4),o.TgZ(5,"div",5)(6,"button",6),o.NdJ("click",function(){return n.addPublicacion()}),o.TgZ(7,"mat-icon"),o._uU(8,"add"),o.qZA()()()()),2&i&&(o.Q6J("title","all"==n.origin?"Publicaciones":"myPublicaciones"==n.origin?"Mis Publicaciones":"Mis Compras"),o.xp6(3),o.Q6J("ngIf","all"==n.origin),o.xp6(1),o.Q6J("ngIf",!n.loading))},dependencies:[d.sg,d.O5,f.KE,f.hX,A.Hw,L.Nt,I.cs,F.gD,J.ey,h.XC,h.ZL,p.RA,p.oH,p.qH,p.z3,y.gM,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,s.fD,s.QQ,s.VE,s.I,s.fA,s.ud,S.G,U.O,N.o,d.Ov],styles:["#main-publicaciones[_ngcontent-%COMP%]{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]{padding:10px 0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]{margin:0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]   .accordion-header-button[_ngcontent-%COMP%]{height:40px;font-size:14px;padding:10px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]{display:flex;flex-direction:column}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:100%;padding:5px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 5px;height:36px;font-size:12px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros.localidad-row[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr!important}#main-publicaciones[_ngcontent-%COMP%]   .floating-button-container[_ngcontent-%COMP%]{position:fixed;right:25px;bottom:40px;z-index:999}@media (min-width: 0px) and (max-width: 768px){#main-publicaciones[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]}),t})()}];let z=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[u.Bz.forChild(R),u.Bz]}),t})();var D=e(8796),K=e(9499),V=e(4466);let X=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[d.ez,z,D.q,s.IJ,K.O,V.m]}),t})()}}]);