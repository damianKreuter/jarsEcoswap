"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[76],{3738:(mn,C,r)=>{r.r(C),r.d(C,{PublicacionModule:()=>ln});var u=r(4755),m=r(1531),w=r(5226),h=r.n(w),g=r(5580),n=r(2223),f=r(2777),b=r(1728),O=r(7833),P=r(9229);function A(t,c){if(1&t&&(n.TgZ(0,"div",8)(1,"h3"),n._uU(2,"Vas a intercambiar por:"),n.qZA(),n.TgZ(3,"div",9),n._UZ(4,"app-card",10),n.qZA()()),2&t){const i=n.oxw(2);n.xp6(4),n.Q6J("cardData",i.cardPublicacionOrigen)}}function q(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"div",11)(1,"h3",12),n._uU(2,"Seleccion\xe1 una de tus publicaciones para intercambiar!"),n.qZA(),n.TgZ(3,"div",13)(4,"app-deck",14),n.NdJ("cardSelected",function(o){n.CHM(i);const a=n.oxw(2);return n.KtG(a.selectCard(o))}),n.qZA()()()}if(2&t){const i=n.oxw(2);n.xp6(4),n.Q6J("cardList",i.publicacionesCardList)("fixedPageSize",1)("smallWidth",!0)}}function y(t,c){1&t&&(n.TgZ(0,"div"),n._uU(1,"No ten\xe9s publicaciones a\xfan! Cre\xe1 una para poder hacer intercambios"),n.qZA())}function D(t,c){if(1&t&&(n.TgZ(0,"div",4),n.YNc(1,A,5,1,"div",5),n.YNc(2,q,5,3,"div",6),n.YNc(3,y,2,0,"div",7),n.qZA()),2&t){const i=n.oxw();n.xp6(1),n.Q6J("ngIf",i.cardPublicacionOrigen),n.xp6(1),n.Q6J("ngIf",i.publicacionesCardList.length>0),n.xp6(1),n.Q6J("ngIf",0==i.publicacionesCardList.length)}}let I=(()=>{class t{constructor(i,e,o){this.data=i,this.truequeService=e,this.dialogRef=o,this.imagenPublicacion="",this.loading=!1,this.misPublicaciones=[],this.publicacionesCardList=[],console.log(i),this.publicacionOrigen=i.publicacion,this.cardPublicacionOrigen={id:this.publicacionOrigen.idPublicacion,imagen:this.publicacionOrigen.parsedImagenes?this.publicacionOrigen.parsedImagenes[0]:"no_image",titulo:this.publicacionOrigen.titulo,valorPrincipal:`$${this.publicacionOrigen.valorTruequeMin} - $${this.publicacionOrigen.valorTruequeMax}`,fecha:this.publicacionOrigen.fechaPublicacion,usuario:{id:this.publicacionOrigen.particularDTO.usuarioDTO.idUsuario,imagen:"assets/perfiles/perfiles-17.jpg",nombre:this.publicacionOrigen.particularDTO.nombre+" "+this.publicacionOrigen.particularDTO.apellido,puntaje:this.publicacionOrigen.particularDTO.puntaje,localidad:this.publicacionOrigen.particularDTO.direcciones[0].localidad},action:"detail",buttons:[],estado:this.publicacionOrigen.estadoTrueque},this.getMisPublicaciones(),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}getMisPublicaciones(){this.truequeService.getMisPublicacionesForTrueque(this.publicacionOrigen.idPublicacion).subscribe({next:i=>{console.log(i),this.misPublicaciones=i,this.misPublicaciones.map(e=>{e.parsedImagenes=e.imagenes.split("|")})},error:i=>{console.log(i)},complete:()=>this.parsePublicaciones()})}parsePublicaciones(){this.publicacionesCardList.splice(0);const i=[];for(const e of this.misPublicaciones)i.push({id:e.idPublicacion,imagen:e.parsedImagenes?e.parsedImagenes[0]:"no_image",titulo:e.titulo,valorPrincipal:`$${e.valorTruequeMin} - $${e.valorTruequeMax}`,fecha:e.fechaPublicacion,usuario:{id:e.particularDTO.usuarioDTO.idUsuario,imagen:"assets/perfiles/perfiles-17.jpg",nombre:e.particularDTO.nombre+" "+e.particularDTO.apellido,puntaje:e.particularDTO.puntaje,localidad:e.particularDTO.direcciones[0].localidad},action:"select",buttons:[],estado:e.estadoTrueque});this.publicacionesCardList=i}getImage(i){return this.truequeService.getImagen(i)}selectCard(i){this.cardSelected=i}solicitarTrueque(){this.cardSelected&&this.truequeService.crearTrueque(this.publicacionOrigen.idPublicacion,this.cardSelected).subscribe({next:i=>{console.log(i),h().fire("\xa1Trueque creado!","Se solicit\xf3 el intercambio, solo falta que lo acepten!","success").then(({isConfirmed:e})=>{this.dialogRef.close(e)})}})}close(){this.dialogRef.close()}}return t.\u0275fac=function(i){return new(i||t)(n.Y36(g.WI),n.Y36(f.x),n.Y36(g.so))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-trocar-modal"]],decls:6,vars:2,consts:[["id","main-trocar",4,"ngIf"],["id","trocar-buttons"],["mat-fab","","extended","","color","light",3,"click"],["mat-fab","","extended","","color","primary",3,"disabled","click"],["id","main-trocar"],["class","publicacion-origen",4,"ngIf"],["class","mis-publicaciones",4,"ngIf"],[4,"ngIf"],[1,"publicacion-origen"],[2,"transform","scale(0.8)","transform-origin","top","max-height","60vh"],["app","publicaciones",3,"cardData"],[1,"mis-publicaciones"],[2,"text-align","center"],[2,"max-width","98%","transform","scale(0.8)","transform-origin","top","max-height","60vh"],["app","publicaciones",3,"cardList","fixedPageSize","smallWidth","cardSelected"]],template:function(i,e){1&i&&(n.YNc(0,D,4,3,"div",0),n.TgZ(1,"div",1)(2,"button",2),n.NdJ("click",function(){return e.close()}),n._uU(3,"CANCELAR"),n.qZA(),n.TgZ(4,"button",3),n.NdJ("click",function(){return e.solicitarTrueque()}),n._uU(5,"SOLICITAR INTERCAMBIO"),n.qZA()()),2&i&&(n.Q6J("ngIf",!e.loading),n.xp6(4),n.Q6J("disabled",!e.cardSelected))},dependencies:[u.O5,b.cs,O.A,P.o],styles:["#main-trocar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;justify-items:center;align-items:center}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]{margin:10px 0;padding-right:15px;border-right:1px solid grey;text-align:center;width:95%}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;border-radius:10px}#main-trocar[_ngcontent-%COMP%]   .mis-publicaciones[_ngcontent-%COMP%]{overflow:auto;padding:10px}#trocar-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;justify-items:center;margin:10px;gap:10px}@media (min-width: 0px) and (max-width: 576px){#main-trocar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr!important}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]{border-right:none!important;border-bottom:1px solid grey}#main-trocar[_ngcontent-%COMP%]   .mis-publicaciones[_ngcontent-%COMP%]{height:40vh!important}#trocar-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]}),t})();var Z=r(5500);const v="URImsUsuarios";let x=(()=>{class t{constructor(i){this.backendService=i}getMyMensajes(i){return this.backendService.get(v,`api/chat/${i}`)}sendMensaje(i){return this.backendService.post(v,"api/chat",i)}}return t.\u0275fac=function(i){return new(i||t)(n.LFG(Z.k))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var j=r(9114),M=r(430),S=r(9609),_=r(9401);function J(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"div",9),n.NdJ("mouseover",function(){n.CHM(i);const o=n.oxw();return n.KtG(0==o.initChat?o.scrollToBottom():"")}),n._uU(1),n.TgZ(2,"mat-icon",10),n.NdJ("click",function(){n.CHM(i);const o=n.oxw();return n.KtG(o.dialogRef.close())}),n._uU(3,"close"),n.qZA()()}if(2&t){const i=n.oxw();n.xp6(1),n.AsE(" Chate\xe1 con ",i.elOtroSwapper.nombre," ",i.elOtroSwapper.apellido," ")}}function U(t,c){if(1&t&&(n.TgZ(0,"div",11)(1,"span",12),n._uU(2),n.qZA(),n.TgZ(3,"span",13),n._uU(4),n.ALo(5,"date"),n.qZA(),n.TgZ(6,"mat-icon",14),n._uU(7,"arrow_drop_down"),n.qZA()()),2&t){const i=c.$implicit,e=n.oxw();n.Q6J("ngClass",i.usuarioEmisor.idUsuario==e.userData.id_user?"mio":"otro"),n.xp6(2),n.Oqu(i.mensaje),n.xp6(2),n.Oqu(n.xi3(5,3,i.fechaHoraEnvio,"dd/MM/yyyy"))}}function E(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"textarea",15),n.NdJ("ngModelChange",function(o){n.CHM(i);const a=n.oxw();return n.KtG(a.nuevoMensaje=o)}),n.qZA()}if(2&t){const i=n.oxw();n.Q6J("placeholder","Enviar mensaje a "+i.elOtroSwapper.nombre+" "+i.elOtroSwapper.apellido)("ngModel",i.nuevoMensaje)}}function N(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"button",16),n.NdJ("click",function(){n.CHM(i);const o=n.oxw();return n.KtG(o.sendMensaje())}),n.TgZ(1,"mat-icon"),n._uU(2,"send"),n.qZA()()}}function k(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"button",17),n.NdJ("click",function(){n.CHM(i);const o=n.oxw();return n.KtG(o.sendMensaje())}),n._uU(1,"Enviar"),n.qZA()}}let T=(()=>{class t{constructor(i,e,o,a){this.data=i,this.chatService=e,this.document=o,this.dialogRef=a,this.mensajes=[],this.trueques=[],this.nuevoMensaje="",this.origin="inline",this.initChat=0,i&&(this.mensajes=i.mensajes,this.userData=i.userData,this.elOtroSwapper=i.elOtroSwapper,this.trueques=i.trueques,this.userType=i.userType,this.publicacion=i.publicacion,this.origin="modal")}scrollToBottom(){const i="inline"==origin?"chatContainer":"modal-chat-container",e=this.document.getElementById(i);e&&(e.scrollTop=e.scrollHeight),this.initChat++}sendMensaje(){const i=this.trueques.find(e=>e.publicacionDTOorigen.idPublicacion==this.publicacion.idPublicacion&&"APROBADO"==e.estadoTrueque);i&&i.idTrueque&&this.chatService.sendMensaje({idTrueque:i.idTrueque,mensaje:this.nuevoMensaje,usuarioReceptor:"publicacionOrigen"==this.userType?i.publicacionDTOpropuesta.particularDTO.usuarioDTO.idUsuario:i.publicacionDTOorigen.particularDTO.usuarioDTO.idUsuario}).subscribe({next:e=>{console.log("mensaje enviado:",e),this.chatService.getMyMensajes(i.idTrueque).subscribe({next:o=>{this.mensajes=o,this.nuevoMensaje=""}})}})}}return t.\u0275fac=function(i){return new(i||t)(n.Y36(g.WI,8),n.Y36(x),n.Y36(u.K0),n.Y36(g.so,8))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-chat"]],inputs:{mensajes:"mensajes",userData:"userData",elOtroSwapper:"elOtroSwapper"},decls:9,vars:14,consts:[["class","header",3,"mouseover",4,"ngIf"],[2,"margin-bottom","20px","overflow","auto","scrollbar-color","#888 #f1f1f1","scrollbar-width","thin",3,"id","mouseover"],["chatContainer",""],["class","mensaje",3,"ngClass",4,"ngFor","ngForOf"],[2,"display","flex",3,"mouseover"],["appearance","outline","floatLabel","always",2,"min-width","210px","width","100%"],["matInput","","style","resize: none;",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],["mat-fab","","color","primary","style","margin-top: 10px;",3,"click",4,"ngIf"],["mat-fab","","extended","","color","primary",3,"click",4,"ngIf"],[1,"header",3,"mouseover"],[2,"position","absolute","right","2rem",3,"click"],[1,"mensaje",3,"ngClass"],[2,"width","100%"],[2,"font-size","10px"],[1,"arrow-globo"],["matInput","",2,"resize","none",3,"placeholder","ngModel","ngModelChange"],["mat-fab","","color","primary",2,"margin-top","10px",3,"click"],["mat-fab","","extended","","color","primary",3,"click"]],template:function(i,e){1&i&&(n.YNc(0,J,4,2,"div",0),n.TgZ(1,"div",1,2),n.NdJ("mouseover",function(){return 0==e.initChat?e.scrollToBottom():""}),n.YNc(3,U,8,6,"div",3),n.qZA(),n.TgZ(4,"div",4),n.NdJ("mouseover",function(){return 0==e.initChat?e.scrollToBottom():""}),n.TgZ(5,"mat-form-field",5),n.YNc(6,E,1,2,"textarea",6),n.qZA(),n.YNc(7,N,3,0,"button",7),n.YNc(8,k,2,0,"button",8),n.qZA()),2&i&&(n.Q6J("ngIf","modal"==e.origin),n.xp6(1),n.Udp("max-height","inline"==e.origin?200:300,"px"),n.ekj("main-div","modal"==e.origin),n.Q6J("id","inline"==e.origin?"chatContainer":"modal-chat-container"),n.xp6(2),n.Q6J("ngForOf",e.mensajes),n.xp6(1),n.Udp("flex-direction","inline"==e.origin?"column":"row"),n.ekj("main-div","modal"==e.origin),n.xp6(2),n.Q6J("ngIf",e.elOtroSwapper),n.xp6(1),n.Q6J("ngIf","modal"==e.origin),n.xp6(1),n.Q6J("ngIf","inline"==e.origin))},dependencies:[j.KE,M.Hw,S.Nt,b.cs,_.Fj,_.JJ,_.On,u.mk,u.sg,u.O5,u.uU],styles:[".header[_ngcontent-%COMP%]{text-align:center;margin:20px;padding-bottom:20px;border-bottom:1px solid var(--light-grey)}#chatContainer[_ngcontent-%COMP%]{scrollbar-color:#888 #f1f1f1;scrollbar-width:thin}[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:5px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:5px}#chatContainer[_ngcontent-%COMP%]{scroll-behavior:smooth}.main-div[_ngcontent-%COMP%]{margin:10px 20px;gap:20px}.mensaje[_ngcontent-%COMP%]{padding:10px;border-radius:15px;position:relative;margin:10px 5px 25px;display:flex;flex-direction:column;align-items:flex-end}.mensaje.mio[_ngcontent-%COMP%]{background:var(--primary-color)}.mensaje.mio[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{right:0;bottom:-25px;color:var(--primary-color)}.mensaje.otro[_ngcontent-%COMP%]{background-color:var(--light-grey)}.mensaje.otro[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{text-align:left}.mensaje.otro[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{left:0;bottom:-25px;color:var(--light-grey)}.mensaje[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{position:absolute;font-size:45px;width:45px;height:45px}"]}),t})();var Y=r(3073),B=r(4377),L=r(5763),Q=r(4666),p=r(3148),R=r(7876),F=r(4984),$=r(6262);function H(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"div")(1,"app-main-card-publicacion",4),n.NdJ("intercambiarEvent",function(){n.CHM(i);const o=n.oxw(2);return n.KtG(o.intercambiar())})("comprarEvent",function(){n.CHM(i);const o=n.oxw(2);return n.KtG(o.comprar())}),n.qZA()()}if(2&t){const i=n.oxw(2);n.xp6(1),n.Q6J("publicacion",i.publicacion)("userData",i.userData)("userType",i.userType)}}function W(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"button",21),n.NdJ("click",function(){n.CHM(i);const o=n.oxw(3);return n.KtG(o.openChat())}),n.TgZ(1,"mat-icon"),n._uU(2,"open_in_new"),n.qZA()()}}function z(t,c){if(1&t&&n._UZ(0,"app-chat",22),2&t){const i=n.oxw(3);n.Q6J("mensajes",i.mensajes)("userData",i.userData)("elOtroSwapper",i.elOtroSwapper)}}function K(t,c){if(1&t&&(n.TgZ(0,"div",5)(1,"div",6,7)(3,"div",8,9)(5,"h2",10)(6,"button",11)(7,"mat-icon"),n._uU(8,"question_answer"),n.qZA(),n.TgZ(9,"span",12)(10,"span"),n._uU(11,"Chat"),n.qZA()(),n.YNc(12,W,3,0,"button",13),n.qZA()(),n.TgZ(13,"div",14)(14,"div",15),n.YNc(15,z,1,3,"ng-template"),n.qZA()()()(),n.TgZ(16,"div",16)(17,"div",17),n._UZ(18,"app-card",18),n.qZA(),n.TgZ(19,"div",19)(20,"mat-icon",20),n._uU(21),n.qZA()(),n.TgZ(22,"div",17),n._UZ(23,"app-card",18),n.qZA()()()),2&t){const i=n.oxw(2);n.xp6(3),n.Q6J("collapsed",!1)("disabled",i.screenWidth>576),n.xp6(9),n.Q6J("ngIf",i.screenWidth>576),n.xp6(6),n.Q6J("cardData",i.mainPublicacionCard),n.xp6(3),n.hij(" ",i.screenWidth>992?"swap_horiz":"swap_vert"," "),n.xp6(2),n.Q6J("cardData",i.truequeAceptado[0])}}function G(t,c){if(1&t&&(n.TgZ(0,"div"),n.YNc(1,H,2,3,"div",2),n.YNc(2,K,24,6,"div",3),n.qZA()),2&t){const i=n.oxw();n.xp6(1),n.Q6J("ngIf",0==i.truequeAceptado.length),n.xp6(1),n.Q6J("ngIf",i.userData.isLoggedIn&&1==i.truequeAceptado.length&&i.mainPublicacionCard)}}function V(t,c){1&t&&(n.TgZ(0,"div",25),n._uU(1," Esta publicaci\xf3n no tiene nuevas propuestas a\xfan! "),n.qZA())}function X(t,c){if(1&t){const i=n.EpF();n.TgZ(0,"div")(1,"app-deck",26),n.NdJ("statusChanged",function(){n.CHM(i);const o=n.oxw(2);return n.KtG(o.getTrueques())}),n.qZA()()}if(2&t){const i=n.oxw(2);n.xp6(1),n.Q6J("cardList",i.truequesActivos)("fullScreenWidth",!0)}}function nn(t,c){if(1&t&&(n.TgZ(0,"div")(1,"h3",23),n._uU(2," Historial de Trueques "),n.qZA(),n._UZ(3,"app-deck",27),n.qZA()),2&t){const i=n.oxw(2);n.xp6(3),n.Q6J("cardList",i.historialTrueques)("fullScreenWidth",!0)}}function en(t,c){if(1&t&&(n.TgZ(0,"div")(1,"div")(2,"h3",23),n._uU(3),n.qZA(),n.YNc(4,V,2,0,"div",24),n.YNc(5,X,2,2,"div",2),n.qZA(),n.YNc(6,nn,4,2,"div",2),n.qZA()),2&t){const i=n.oxw();n.xp6(3),n.hij(" ","publicacionPropuesta"==i.userType?"Mi Trueque Activo":"Propuestas de Trueque"," "),n.xp6(1),n.Q6J("ngIf",0==i.truequesActivos.length&&!i.loading),n.xp6(1),n.Q6J("ngIf",i.truequesActivos.length>0),n.xp6(1),n.Q6J("ngIf",i.historialTrueques.length>0)}}const tn=[{path:"",component:(()=>{class t{constructor(i,e,o,a,s,l,d,un,pn,dn){this.truequeService=i,this.route=e,this.showErrorService=o,this.auth=a,this.router=s,this.usuarioService=l,this.dialog=d,this.comprasService=un,this.document=pn,this.chatService=dn,this.loading=!1,this.publicacionesToShow=[],this.trueques=[],this.userType="notLoggedIn",this.truequeAceptado=[],this.historialTrueques=[],this.truequesActivos=[],this.init=0,this.mensajes=[],this.nuevoMensaje="",this.initChat=0,this.userData={isSwapper:a.isUserSwapper(),isLoggedIn:a.isUserLoggedIn},this.route.paramMap.subscribe(gn=>{this.loading=!0,this.id_publicacion=gn.get("id_publicacion"),this.truequeAceptado=[],this.historialTrueques=[],this.truequesActivos=[],0!=this.init&&this.ngAfterViewInit(),this.init++}),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}ngAfterViewInit(){this.userData&&this.userData.isLoggedIn?(this.userData.id_user=this.auth.getUserID(),this.usuarioService.getUserByID(this.auth.getUserID()).subscribe({next:i=>{this.userInfo=i,this.getPublicacion(this.id_publicacion)}})):this.getPublicacion(this.id_publicacion),this.scrollToBottom()}scrollToBottom(){const i=this.document.getElementById("chatContainer");i&&(i.scrollTop=i.scrollHeight)}getPublicacion(i){this.truequeService.getPublicacion(i).subscribe({next:e=>{this.publicacion=e,this.publicacion.parsedImagenes=this.publicacion.imagenes.split("|"),this.publicacion&&this.userInfo&&this.publicacion.particularDTO.idParticular==this.userInfo.particularDTO.idParticular&&(this.userType="publicacionOrigen"),this.userData.isLoggedIn?this.getTrueques():this.loading=!1},error:e=>{console.log(e),this.loading=!1}})}getTrueques(){this.loading=!0,this.truequesActivos.splice(0),this.historialTrueques.splice(0),this.truequeAceptado.splice(0),this.publicacionesToShow.splice(0),this.truequeService.getTruequesFromPublicacion(this.publicacion.idPublicacion).subscribe({next:i=>{if(this.trueques=i,"publicacionOrigen"!=this.userType&&this.userData.isLoggedIn)this.truequeService.getMisPublicaciones().subscribe({next:e=>{const o=e;for(const a of this.trueques){const s=o.find(l=>a.publicacionDTOpropuesta.idPublicacion==l.idPublicacion);s&&(s.estadoTrueque=a.estadoTrueque.trim(),this.publicacionesToShow.push(s),this.userType="publicacionPropuesta")}this.publicacionesToShow.map(a=>{a.parsedImagenes=a.imagenes.split("|")})},error:()=>{this.loading=!1},complete:()=>{this.parsePublicaciones(),this.loading=!1}});else if("publicacionOrigen"==this.userType&&this.userData.isLoggedIn){for(const e of i)e.publicacionDTOpropuesta.estadoTrueque=e.estadoTrueque.trim(),this.publicacionesToShow.push(e.publicacionDTOpropuesta);this.publicacionesToShow.map(e=>{e.parsedImagenes=e.imagenes.split("|")}),this.parsePublicaciones(),this.loading=!1}},error:()=>{this.loading=!1}})}intercambiar(){if(this.auth.isUserLoggedIn){let i;i=this.screenWidth<576?{data:{publicacion:this.publicacion},width:"70vw",height:"80vh",position:{top:"50vh",left:"50vw"},panelClass:"makeItMiddle"}:{data:{publicacion:this.publicacion},width:"80vw",height:"85vh"},this.dialog.open(I,i).afterClosed().subscribe(o=>{console.log("result trocar",o),o&&this.getTrueques()})}else h().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder intercambiar, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:i})=>{i&&this.router.navigate(["login"])})}comprar(){this.auth.isUserLoggedIn?this.comprasService.comprar(this.publicacion.idPublicacion).subscribe({next:i=>{console.log(i),h().fire({title:"\xa1Ya casi es tuyo!",text:"Termin\xe1 tu compra en Mercado Pago, luego podr\xe1s verla en Mis Compras!",icon:"success",confirmButtonText:"\xa1VAMOS!",allowOutsideClick:!1,allowEscapeKey:!1}).then(({isConfirmed:e})=>{e&&(this.router.navigate(["/mis-compras"]),window.open(i.initPoint,"_blank"))})}}):h().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder comprar, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:i})=>{i&&this.router.navigate(["login"])})}getButtonsForCards(){return"publicacionPropuesta"==this.userType?[{name:"CANCELAR",icon:"close",color:"warn",status:"CANCELADO"}]:"publicacionOrigen"==this.userType?[{name:"ACEPTAR",icon:"check",color:"primary",status:"APROBADO"},{name:"RECHAZAR",icon:"close",color:"warn",status:"RECHAZADO"},{name:"RECIBIDO",icon:"done_all",color:"primary",status:"RECIBIDO"}]:[]}parsePublicaciones(){this.truequesActivos.splice(0),this.historialTrueques.splice(0),this.truequeAceptado.splice(0);const i=[],e=[],o=[];for(const a of this.publicacionesToShow){const s={id:a.idPublicacion,imagen:a.parsedImagenes?a.parsedImagenes[0]:"no_image",titulo:a.titulo,valorPrincipal:`$${a.valorTruequeMin} - $${a.valorTruequeMax}`,fecha:a.fechaPublicacion,usuario:{id:a.particularDTO.usuarioDTO.idUsuario,imagen:a.particularDTO.usuarioDTO.avatar,nombre:a.particularDTO.nombre+" "+a.particularDTO.apellido,puntaje:a.particularDTO.puntaje,localidad:a.particularDTO.direcciones[0].localidad},action:"detail",buttons:[],estado:a.estadoTrueque,idAuxiliar:this.trueques.find(l=>l.publicacionDTOpropuesta.idPublicacion==a.idPublicacion)?.idTrueque};if("APROBADO"==a.estadoTrueque){i.push(s);const l=this.trueques.find(d=>d.publicacionDTOpropuesta.idPublicacion==a.idPublicacion&&"APROBADO"==d.estadoTrueque);l&&(this.elOtroSwapper="publicacionOrigen"==this.userType?l.publicacionDTOpropuesta.particularDTO:l.publicacionDTOorigen.particularDTO,this.chatService.getMyMensajes(l.idTrueque).subscribe({next:d=>{this.mensajes=d}}))}else"PENDIENTE"==a.estadoTrueque&&"ABIERTA"==a.estadoPublicacion?(s.valorSecundario=a.precioVenta?`$${a.precioVenta}`:void 0,s.buttons=this.getButtonsForCards(),e.push(s)):(s.disabled=!0,o.push(s))}this.mainPublicacionCard={id:this.publicacion.idPublicacion,imagen:this.publicacion.parsedImagenes?this.publicacion.parsedImagenes[0]:"no_image",titulo:this.publicacion.titulo,valorPrincipal:`$${this.publicacion.valorTruequeMin} - $${this.publicacion.valorTruequeMax}`,fecha:this.publicacion.fechaPublicacion,usuario:{id:this.publicacion.particularDTO.usuarioDTO.idUsuario,imagen:this.publicacion.particularDTO.usuarioDTO.avatar,nombre:this.publicacion.particularDTO.nombre+" "+this.publicacion.particularDTO.apellido,puntaje:this.publicacion.particularDTO.puntaje,localidad:this.publicacion.particularDTO.direcciones[0].localidad},action:"detail",buttons:[],estado:this.publicacion.estadoPublicacion,idAuxiliar:this.trueques.find(a=>a.publicacionDTOpropuesta.idPublicacion==this.publicacion.idPublicacion)?.idTrueque},this.truequeAceptado=i,this.truequesActivos=e,this.historialTrueques=o}hasApprovedTrueque(){return this.publicacionesToShow.filter(i=>"APROBADO"==i.estadoTrueque)}openChat(){this.dialog.open(T,{data:{mensajes:this.mensajes,userData:this.userData,elOtroSwapper:this.elOtroSwapper,trueques:this.trueques,userType:this.userType,publicacion:this.publicacion},height:"85vh"}).afterClosed().subscribe(e=>{console.log("result trocar",e),e&&this.getTrueques()})}}return t.\u0275fac=function(i){return new(i||t)(n.Y36(f.x),n.Y36(m.gz),n.Y36(Y.x),n.Y36(B.e),n.Y36(m.F0),n.Y36(L.i),n.Y36(g.uw),n.Y36(Q.K),n.Y36(u.K0),n.Y36(x))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-publicacion"]],decls:5,vars:3,consts:[["id","main-publicacion",1,"app-main-div",3,"mouseover"],[3,"loading"],[4,"ngIf"],["class","main-row",4,"ngIf"],[3,"publicacion","userData","userType","intercambiarEvent","comprarEvent"],[1,"main-row"],["ngbAccordion","",1,"dense-3",2,"min-width","255px"],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed","disabled"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px","display","flex","align-items","center","gap","10px"],["mat-mini-fab","","class","open-chat",3,"click",4,"ngIf"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"row"],[1,"col-sm-12","col-lg-5"],["app","publicaciones",3,"cardData"],[1,"col-sm-12","col-lg-2",2,"display","flex","align-items","center","justify-content","center"],[1,"swap-icon"],["mat-mini-fab","",1,"open-chat",3,"click"],[3,"mensajes","userData","elOtroSwapper"],[2,"margin","20px 0 0 5px","font-weight","bold"],["style","text-align: center;",4,"ngIf"],[2,"text-align","center"],["app","publicaciones",3,"cardList","fullScreenWidth","statusChanged"],["app","publicaciones",3,"cardList","fullScreenWidth"]],template:function(i,e){1&i&&(n._UZ(0,"app-header"),n.TgZ(1,"div",0),n.NdJ("mouseover",function(){return 0==e.initChat?e.scrollToBottom():""}),n._UZ(2,"app-spinner",1),n.YNc(3,G,3,2,"div",2),n.YNc(4,en,7,4,"div",2),n.qZA()),2&i&&(n.xp6(2),n.Q6J("loading",e.loading),n.xp6(1),n.Q6J("ngIf",!e.loading),n.xp6(1),n.Q6J("ngIf",e.userData.isLoggedIn&&0==e.truequeAceptado.length&&e.mainPublicacionCard&&"ABIERTA"==e.mainPublicacionCard.estado))},dependencies:[u.O5,M.Hw,b.nh,p.fD,p.QQ,p.VE,p.I,p.fA,p.ud,R.G,F.O,O.A,P.o,T,$.r],styles:["#main-publicacion[_ngcontent-%COMP%]{padding:2%}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]{padding:10px 0}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]{margin:0}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]   .accordion-header-button[_ngcontent-%COMP%]{height:40px;font-size:14px;padding:10px;display:flex;justify-content:space-between}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]   .accordion-header-button[_ngcontent-%COMP%]   .open-chat[_ngcontent-%COMP%]{background-color:var(--info)}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]{scrollbar-color:#888 #f1f1f1;scrollbar-width:thin}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:5px}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-body[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:5px}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   #chatContainer[_ngcontent-%COMP%]{scroll-behavior:smooth}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]{padding:10px;border-radius:15px;position:relative;margin:10px 5px 25px;display:flex;flex-direction:column;align-items:flex-end}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje.mio[_ngcontent-%COMP%]{background:var(--primary-color)}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje.mio[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{right:0;bottom:-25px;color:var(--primary-color)}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje.otro[_ngcontent-%COMP%]{background-color:var(--light-grey)}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje.otro[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{text-align:left}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje.otro[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{left:0;bottom:-25px;color:var(--light-grey)}#main-publicacion[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]   .arrow-globo[_ngcontent-%COMP%]{position:absolute;font-size:45px;width:45px;height:45px}#main-publicacion[_ngcontent-%COMP%]   .main-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-publicacion[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .half-card[_ngcontent-%COMP%]{max-width:60%}#main-publicacion[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .half-deck[_ngcontent-%COMP%]{max-width:40%}#main-publicacion[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .swap-icon[_ngcontent-%COMP%]{font-size:45px;width:45px;height:45px;color:var(--primary-color)}#main-publicacion[_ngcontent-%COMP%]   .donacion-example-header-image[_ngcontent-%COMP%]{background-image:url(perfiles-17.f67e69cf999cd190.jpg);background-size:cover}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;gap:1rem}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:65px;margin:5px;border-radius:5px;box-shadow:2px 2px 5px var(--dark-grey)}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]{display:flex;flex-direction:column}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:5px auto;width:150px}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .aprobada[_ngcontent-%COMP%]{color:var(--success);font-weight:500}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .rechazada[_ngcontent-%COMP%]{color:var(--warn)}@media (min-width: 0px) and (max-width: 576px){.card-content[_ngcontent-%COMP%], .donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr!important}.main-row[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}@media (min-width: 768px){.accordion-button[_ngcontent-%COMP%]:after{display:none}}"]}),t})()}];let on=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[m.Bz.forChild(tn),m.Bz]}),t})();var an=r(9433),cn=r(9499),rn=r(4466),sn=r(6012);let ln=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[u.ez,on,an.q,p.IJ,cn.O,rn.m,sn.QW]}),t})()}}]);