"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[706],{1706:(y,m,s)=>{s.r(m),s.d(m,{DonacionesModule:()=>Z});var p=s(4755),h=s(1531),f=s(8988),C=s(8088),v=s(5226),g=s.n(v),n=s(2223),D=s(5580),x=s(8628),_=s(3073),O=s(4303),A=s(430),M=s(1728),r=s(3148),b=s(7876),E=s(9229);function I(a,c){if(1&a){const t=n.EpF();n.TgZ(0,"div",16)(1,"button",17),n.NdJ("click",function(){n.CHM(t);const o=n.oxw(2);return n.KtG(o.selectDonaciones())}),n._uU(2," SELECCIONAR DONACIONES PARA ENVIAR CON SHIPNOW "),n.qZA(),n.TgZ(3,"button",18),n.NdJ("click",function(){n.CHM(t);const o=n.oxw(2);return n.KtG(o.cancelSelect())}),n._uU(4," CANCELAR "),n.qZA(),n.TgZ(5,"button",19),n.NdJ("click",function(){n.CHM(t);const o=n.oxw(2);return n.KtG(o.confirmSelectedCards())}),n._uU(6," CONFIRMAR SELECCI\xd3N "),n.qZA()()}if(2&a){const t=n.oxw(2);n.xp6(1),n.Q6J("disabled",t.selectingMode),n.xp6(2),n.Q6J("disabled",!t.selectingMode),n.xp6(2),n.Q6J("disabled",!t.selectingMode||0==t.selectedCards.length)}}function P(a,c){1&a&&(n.TgZ(0,"div",20),n._uU(1," No ten\xe9s donaciones pendientes de env\xedo! "),n.qZA())}function N(a,c){if(1&a&&(n.YNc(0,I,7,3,"div",14),n.YNc(1,P,2,0,"div",15)),2&a){const t=n.oxw();n.Q6J("ngIf",t.showButtons()),n.xp6(1),n.Q6J("ngIf",!t.showButtons())}}function T(a,c){if(1&a){const t=n.EpF();n.TgZ(0,"div")(1,"app-deck",21),n.NdJ("modalClosed",function(o){n.CHM(t);const i=n.oxw();return n.KtG(i.cardModalClosed(o))})("statusChanged",function(){n.CHM(t);const o=n.oxw();return n.KtG(o.getDonaciones())})("cardSelected",function(o){n.CHM(t);const i=n.oxw();return n.KtG(i.selectCard(o))})("cardUnselected",function(o){n.CHM(t);const i=n.oxw();return n.KtG(i.unselectCard(o))}),n.qZA()()}if(2&a){const t=n.oxw();n.xp6(1),n.Q6J("cardList",t.donacionesCardList)}}function w(a,c){1&a&&(n.TgZ(0,"div",22),n._uU(1," No hay ninguna donaci\xf3n para mostrar! "),n.qZA())}const L=[{path:"",component:(()=>{class a{constructor(t,e,o,i){this.dialog=t,this.donacionesService=e,this.showErrorService=o,this.logisticaService=i,this.donaciones=[],this.donacionesCardList=[],this.loading=!1,this.selectingMode=!1,this.selectedCards=[],this.userOrders=[],this.getDonaciones(),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}getDonaciones(){this.loading=!0,this.donaciones.splice(0),this.logisticaService.obtenerMisOrdenes("donaciones").subscribe({next:t=>{t.length>0&&(this.userOrders=t)}}),this.donacionesService.getMisDonaciones().subscribe({next:t=>{t?(this.donaciones=t,this.donaciones.map(e=>{e.idDonacion&&(e.last_status=e.estado),e.imagenes&&(e.parsedImagenes=e.imagenes.split("|"))})):this.showErrorService.show("Error!","No se encontr\xf3 la informaci\xf3n de tus donaciones. Intent\xe1 nuevamente m\xe1s tarde.")},error:t=>{console.log(t),this.loading=!1},complete:()=>this.generateCardList()})}generateCardList(){this.donacionesCardList.splice(0),this.donaciones.sort((e,o)=>new Date(o.fechaDonacion).getTime()-new Date(e.fechaDonacion).getTime());const t=[];for(const e of this.donaciones){let o="";for(const[l,u]of e.caracteristicaDonacion.entries())0==l?o=u.caracteristica:o+=" - "+u.caracteristica;const i=this.userOrders.filter(l=>l.productosADonarDeOrdenList.some(u=>u.idDonacion==e.idDonacion)),d={id:e.idDonacion,imagen:e.parsedImagenes?e.parsedImagenes[0]:"no_image",titulo:e.descripcion,valorPrincipal:`${e.cantidadDonacion} ${1==e.cantidadDonacion?"unidad":"unidades"} de ${e.producto.descripcion}`,valorSecundario:o,fecha:e.fechaDonacion,usuario:{id:e.producto.colectaDTO.fundacionDTO.usuarioDTO.idUsuario,imagen:e.producto.colectaDTO.fundacionDTO.usuarioDTO.avatar,nombre:e.producto.colectaDTO.fundacionDTO.nombre,puntaje:e.producto.colectaDTO.fundacionDTO.puntaje,localidad:e.producto.colectaDTO.fundacionDTO.direcciones[0].localidad},action:"access",buttons:this.getButtonsForCard(e,i),estado:"RECIBIDO"==e.estadoEnvio?"RECIBIDA":e.estadoDonacion.replace("_"," "),idAuxiliar:e.producto.colectaDTO.idColecta,codigo:"Donaci\xf3n",estadoAux:e.estadoEnvio};t.push(d),this.loading=!1}this.donacionesCardList=t}getButtonsForCard(t,e){return"RECIBIDO"==t.estadoEnvio||"RECIBIDA"==t.estadoDonacion?[{name:"OPINAR",icon:"rate_review",color:"opinion",status:"OPINAR",action:"opinar"}]:"APROBADA"==t.estadoDonacion?e.length>0?e[e.length-1].listaFechaEnvios.find(i=>"CANCELADO"==i.estado)?[{name:"Configurar env\xedo",icon:"local_shipping",color:"info",status:"INFO",action:"configurar_envio"},{name:"Llevar en persona",icon:"directions_walk",color:"info",status:"EN_ESPERA",action:"change_status"}]:[{name:"Ver env\xedo",icon:"local_shipping",color:"info",status:"INFO",action:"ver_envio"}]:[{name:"Configurar env\xedo",icon:"local_shipping",color:"info",status:"INFO",action:"configurar_envio"},{name:"Llevar en persona",icon:"directions_walk",color:"info",status:"EN_ESPERA",action:"change_status"}]:"PENDIENTE"==t.estadoDonacion?[{name:"CANCELAR",icon:"close",color:"warn",status:"CANCELADA",action:"change_status"}]:[]}selectDonaciones(){g().fire({title:"Configur\xe1 tu env\xedo!",text:"Seleccion\xe1 las tarjetas de tus donaciones haciendo click en ellas, vas a ver que las que seleccionen se pintar\xe1n. Record\xe1 que solo pod\xe9s seleccionar donaciones a una misma colecta. Una vez que termines, clicke\xe1 el bot\xf3n CONFIRMAR SELECCI\xd3N.",icon:"info",confirmButtonText:"\xa1VAMOS!"});const t=this.donacionesCardList;t.map(e=>{const o=this.userOrders.filter(i=>i.productosADonarDeOrdenList.some(d=>d.idDonacion==e.id));"APROBADA"==e.estado&&0==o.length?(e.action="select",e.codigo="Donaci\xf3n",e.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO",action:"add_or_remove"}]):e.buttons=[]}),this.donacionesCardList=t,this.selectingMode=!0}showButtons(){return!!this.donacionesCardList.some(t=>"APROBADA"==t.estado)}selectCard(t){const e=this.donacionesCardList.find(o=>o.id==t);if(e)if(0==this.selectedCards.length){this.colectaParaEnvio=e.idAuxiliar,this.donacionesCardList.map(i=>{i.id==t&&(i.isSelected=!0)}),this.selectedCards.push(e);const o=this.donacionesCardList;o.map(i=>{i.idAuxiliar!=this.colectaParaEnvio?(i.action="detail",i.codigo=void 0,i.buttons=[]):this.selectedCards.includes(e)&&i.id==e.id&&(i.buttons=[{name:"Quitar",icon:"remove",color:"info",status:"INFO",action:"add_or_remove"}])}),this.donacionesCardList=o}else this.colectaParaEnvio!=e.idAuxiliar?g().fire("\xa1Colecta distinta!","No pod\xe9s seleccionar distintas colectas para un mismo env\xedo","warning"):(this.selectedCards.push(e),this.donacionesCardList.map(o=>{o.id==e.id&&(o.buttons=[{name:"Quitar",icon:"remove",color:"info",status:"INFO",action:"add_or_remove"}])}))}unselectCard(t){if(this.donacionesCardList.find(o=>o.id==t))if(1==this.selectedCards.length){this.colectaParaEnvio=void 0;const o=this.donacionesCardList;o.map(i=>{const d=this.userOrders.filter(l=>l.productosADonarDeOrdenList.some(u=>u.idDonacion==i.id));console.log(i,d),"APROBADA"==i.estado&&0==d.length?(i.action="select",i.codigo="Donaci\xf3n",i.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO",action:"add_or_remove"}]):(i.action="detail",i.codigo=void 0,i.buttons=[])}),this.donacionesCardList=o,this.selectedCards=[]}else{const o=this.selectedCards.filter(i=>i.id!=t);this.selectedCards=o,this.donacionesCardList.map(i=>{i.id==t&&(i.action="select",i.codigo="Donaci\xf3n",i.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO",action:"add_or_remove"}])})}this.donacionesCardList.map(o=>{o.id==t&&(o.isSelected=!1)})}cancelSelect(){this.selectedCards=[],this.selectingMode=!1;const t=this.donacionesCardList;t.map(e=>{const o=this.userOrders.filter(d=>d.productosADonarDeOrdenList.some(l=>e.id==l.idDonacion)),i=this.donaciones.find(d=>d.idDonacion==e.id);e.action="detail",e.codigo=void 0,i&&(e.buttons=this.getButtonsForCard(i,o))}),this.donacionesCardList=t,this.selectedCards=[]}confirmSelectedCards(){const t=this.donaciones.filter(o=>this.selectedCards.some(i=>i.id==o.idDonacion));this.dialog.open(f.o,{maxWidth:"60vw",maxHeight:"70vh",width:"100%",panelClass:"full-screen-modal",data:{cards:t}}).afterClosed().subscribe(o=>{console.log("closed",o),o&&this.getDonaciones()})}zoomImage(t){g().fire({html:`<img src="${t}" style="width: 100%"/>`,showConfirmButton:!1,showCloseButton:!0})}openDialog(){this.dialog.open(C.G,{maxWidth:"70vw",maxHeight:"60vh",height:"100%",width:"100%",panelClass:"full-screen-modal"})}getImage(t){return this.donacionesService.getImagen(t)}cardModalClosed(t){t.result&&this.cancelSelect()}}return a.\u0275fac=function(t){return new(t||a)(n.Y36(D.uw),n.Y36(x.M),n.Y36(_.x),n.Y36(O.C))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-donaciones"]],decls:18,vars:4,consts:[["title","Mis Donaciones"],["id","main-donaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","",2,"min-width","255px"],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed","disabled"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[4,"ngIf"],["style","margin: 10%; text-align: center;",4,"ngIf"],["class","buttons",4,"ngIf"],["style","min-width: 210px; margin-bottom: 20px; text-align: center;",4,"ngIf"],[1,"buttons"],["mat-fab","","extended","",1,"long-text",3,"disabled","click"],["mat-fab","","extended","",2,"background-color","var(--light-grey)",3,"disabled","click"],["mat-fab","","extended","",2,"background-color","var(--info)",3,"disabled","click"],[2,"min-width","210px","margin-bottom","20px","text-align","center"],["app","donaciones",3,"cardList","modalClosed","statusChanged","cardSelected","cardUnselected"],[2,"margin","10%","text-align","center"]],template:function(t,e){1&t&&(n._UZ(0,"app-header",0),n.TgZ(1,"div",1)(2,"div",2)(3,"div",3,4)(5,"div",5,6)(7,"h2",7)(8,"button",8)(9,"mat-icon"),n._uU(10,"local_shipping"),n.qZA(),n.TgZ(11,"span",9),n._uU(12,"Env\xedo"),n.qZA()()(),n.TgZ(13,"div",10)(14,"div",11),n.YNc(15,N,2,2,"ng-template"),n.qZA()()()()(),n.YNc(16,T,2,1,"div",12),n.YNc(17,w,2,0,"div",13),n.qZA()),2&t&&(n.xp6(5),n.Q6J("collapsed",!1)("disabled",e.screenWidth>768),n.xp6(11),n.Q6J("ngIf",e.donacionesCardList.length>0),n.xp6(1),n.Q6J("ngIf",0==e.donacionesCardList.length))},dependencies:[p.O5,A.Hw,M.cs,r.fD,r.QQ,r.VE,r.I,r.fA,r.ud,b.G,E.o],styles:["#main-donaciones[_ngcontent-%COMP%]{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-donaciones[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:210px;display:flex;flex-direction:column;align-items:center;gap:15px}#main-donaciones[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .long-text[_ngcontent-%COMP%]{background-color:var(--info)}.donacion-example-header-image[_ngcontent-%COMP%]{background-image:url(perfiles-24.8b8b387b71873795.jpg);background-size:cover}.donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;gap:1rem;padding:16px}.donacion-card-content[_ngcontent-%COMP%]   .donacion-aceptada[_ngcontent-%COMP%]{font-weight:700;color:var(--success)}.donacion-card-content[_ngcontent-%COMP%]   .donacion-rechazada[_ngcontent-%COMP%]{font-weight:700;color:var(--warn)}.donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:65px;margin:5px}.donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{cursor:pointer}.donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]{display:flex;align-items:center}.donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:5px}@media (min-width: 0px) and (max-width: 768px){#main-donaciones[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}@media (min-width: 769px){.long-text[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}}@media (min-width: 768px){.accordion-button[_ngcontent-%COMP%]:after{display:none}}"]}),a})()}];let S=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=n.oAB({type:a}),a.\u0275inj=n.cJS({imports:[h.Bz.forChild(L),h.Bz]}),a})();var R=s(9433),B=s(9499),F=s(4466);let Z=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=n.oAB({type:a}),a.\u0275inj=n.cJS({imports:[p.ez,S,R.q,r.IJ,B.O,F.m]}),a})()}}]);