"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[242],{6242:(ci,b,a)=>{a.r(b),a.d(b,{PublicacionesModule:()=>ni});var u=a(4755),h=a(1531),T=a(8675),x=a(4004),A=a(5226),O=a.n(A),i=a(2223),Z=a(4377),r=a(9401),M=a(4893),y=a(3073),I=a(2777),L=a(4666),w=a(4303),C=a(9114),F=a(430),J=a(9609),U=a(1728),S=a(787),D=a(1217),P=a(8995),g=a(6996),E=a(3649),_=a(4867),l=a(3148),N=a(7876),q=a(4984),Q=a(9229);function R(n,s){1&n&&(i.TgZ(0,"button",16)(1,"mat-icon"),i._uU(2,"tune"),i.qZA(),i.TgZ(3,"span",17),i._uU(4,"Filtros"),i.qZA(),i._UZ(5,"span",18),i.qZA())}function Y(n,s){1&n&&(i.TgZ(0,"button",16)(1,"mat-icon"),i._uU(2,"report_problem"),i.qZA(),i.TgZ(3,"span",17),i._uU(4,"\xa1No veo mi compra!"),i.qZA(),i._UZ(5,"span",18),i.qZA())}function B(n,s){if(1&n){const t=i.EpF();i.TgZ(0,"mat-chip-row",37),i.NdJ("removed",function(){const c=i.CHM(t).$implicit,p=i.oxw(3);return i.KtG(p.remove(c))}),i._uU(1),i.TgZ(2,"button",38)(3,"mat-icon",39),i._uU(4,"cancel"),i.qZA()()()}if(2&n){const t=s.$implicit;i.Q6J("matTooltip",t),i.xp6(1),i.hij(" ",t," "),i.xp6(1),i.uIk("aria-label","eliminar "+t)}}function H(n,s){if(1&n&&(i.TgZ(0,"mat-option",40),i._uU(1),i.qZA()),2&n){const t=s.$implicit;i.Q6J("value",t),i.xp6(1),i.hij(" ",t," ")}}function G(n,s){if(1&n&&(i.TgZ(0,"mat-option",40),i._uU(1),i.qZA()),2&n){const t=s.$implicit;i.Q6J("value",t.nombre),i.xp6(1),i.hij(" ",t.descripcion," ")}}function V(n,s){if(1&n){const t=i.EpF();i.TgZ(0,"form",22)(1,"mat-form-field",23)(2,"mat-label"),i._uU(3,"Localidades"),i.qZA(),i.TgZ(4,"mat-chip-grid",24,25),i.YNc(6,B,5,3,"mat-chip-row",26),i.TgZ(7,"input",27,28),i.NdJ("matChipInputTokenEnd",function(e){i.CHM(t);const c=i.oxw(2);return i.KtG(c.add(e))}),i.qZA()(),i.TgZ(9,"mat-autocomplete",29,30),i.NdJ("optionSelected",function(e){i.CHM(t);const c=i.MAs(8);return i.oxw(2).selected(e),i.KtG(c.value="")}),i.YNc(11,H,2,2,"mat-option",31),i.ALo(12,"async"),i.qZA()(),i.TgZ(13,"mat-form-field",32)(14,"mat-label"),i._uU(15,"Tipo del Producto"),i.qZA(),i.TgZ(16,"mat-select",33),i.YNc(17,G,2,2,"mat-option",31),i.qZA()(),i.TgZ(18,"div",34)(19,"button",35),i.NdJ("click",function(){i.CHM(t);const e=i.oxw(2);return i.KtG(e.filtrarPublicaciones())}),i._uU(20,"FILTRAR"),i.qZA(),i.TgZ(21,"button",36),i.NdJ("click",function(){i.CHM(t);const e=i.oxw(2);return i.KtG(e.limpiarFiltros())}),i._uU(22,"LIMPIAR"),i.qZA()()()}if(2&n){const t=i.MAs(5),o=i.MAs(10),e=i.oxw(2);i.Q6J("formGroup",e.formFiltros),i.xp6(6),i.Q6J("ngForOf",e.localidades),i.xp6(1),i.Q6J("matChipInputFor",t)("matAutocomplete",o),i.xp6(4),i.Q6J("ngForOf",i.lcZ(12,6,e.filteredLocalidades)),i.xp6(6),i.Q6J("ngForOf",e.tipos_productos)}}function K(n,s){if(1&n){const t=i.EpF();i.TgZ(0,"div",41)(1,"mat-radio-group",42),i.NdJ("change",function(e){i.CHM(t);const c=i.oxw(2);return i.KtG(c.filterByStatus(e))}),i.TgZ(2,"mat-radio-button",43),i._uU(3,"Todas"),i.qZA(),i.TgZ(4,"mat-radio-button",44),i._uU(5,"Abiertas"),i.qZA(),i.TgZ(6,"mat-radio-button",45),i._uU(7,"Cerradas"),i.qZA()()()}}function j(n,s){1&n&&(i.TgZ(0,"div")(1,"p"),i._uU(2,"Si hiciste una compra y no la ves ac\xe1, prob\xe1 seguir los siguientes pasos:"),i.qZA(),i.TgZ(3,"p"),i._uU(4,"1. Actualiz\xe1 esta p\xe1gina."),i.qZA(),i.TgZ(5,"p"),i._uU(6,"2. Verific\xe1 que hayas pagado correctamente desde tu cuenta de Mercado Pago."),i.qZA(),i.TgZ(7,"p"),i._uU(8,"3. Esper\xe1 48hs desde que pagaste, el pago puede demorar ese tiempo."),i.qZA(),i.TgZ(9,"p"),i._uU(10,"4. Si ya pagaste y no pasaron 48hs, comunicate con nosotros a ecoswapp@gmail.com"),i.qZA()())}function z(n,s){if(1&n&&(i.YNc(0,V,23,8,"form",19),i.YNc(1,K,8,0,"div",20),i.YNc(2,j,11,0,"div",21)),2&n){const t=i.oxw();i.Q6J("ngIf","all"==t.origin),i.xp6(1),i.Q6J("ngIf","myPublicaciones"==t.origin),i.xp6(1),i.Q6J("ngIf","myCompras"==t.origin)}}function $(n,s){1&n&&(i.TgZ(0,"div",34),i._uU(1,"No hay publicaciones para mostrar"),i.qZA())}function W(n,s){if(1&n){const t=i.EpF();i.TgZ(0,"app-deck",46),i.NdJ("statusChanged",function(e){i.CHM(t);const c=i.oxw();return i.KtG(c.filtrarPublicaciones(e))})("modalClosed",function(e){i.CHM(t);const c=i.oxw();return i.KtG(e&&e.result?c.filtrarPublicaciones():"")}),i.qZA()}if(2&n){const t=i.oxw();i.Q6J("cardList",t.filteredPublicacionesCardList)}}function X(n,s){if(1&n){const t=i.EpF();i.TgZ(0,"div",47)(1,"button",48),i.NdJ("click",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.addPublicacion())}),i.TgZ(2,"mat-icon"),i._uU(3,"add"),i.qZA()()()}}const k=[{path:"",component:(()=>{class n{constructor(t,o,e,c,p,m,d,f,ai){this.router=t,this.auth=o,this.fb=e,this.productosService=c,this.showErrorService=p,this.truequesService=m,this.comprasService=d,this.currencyPipe=f,this.logisticaService=ai,this.origin="all",this.tipos_productos=[],this.loading=!0,this.publicacionesToShow=[],this.localidades=[],this.allLocalidades=[],this.publicacionesCardList=[],this.filteredPublicacionesCardList=[],this.trueques=[],this.userOrders=[],this.formFiltros=e.group({fundacion:[""],localidad:[""],tipoProducto:[""]}),"/mis-publicaciones"==t.url&&(this.origin="myPublicaciones"),"/mis-compras"==t.url&&(this.origin="myCompras"),this.filteredLocalidades=this.formFiltros.controls.localidad.valueChanges.pipe((0,T.O)(""),(0,x.U)(v=>v?this._filterLocalidad(v):this.allLocalidades.slice())),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}ngOnInit(){this.getTiposProductos(),this.getLocalidades(),this.filtrarPublicaciones()}addPublicacion(){this.auth.isUserLoggedIn?this.router.navigate(["form-publicacion"]):O().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder crear una publicaci\xf3n, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:t})=>{t&&this.router.navigate(["login"])})}getTiposProductos(){this.productosService.getTiposProductos().subscribe({next:t=>this.tipos_productos=t,error:t=>console.error("error",t)})}filtrarPublicaciones(t){if(console.log(t),this.loading=!0,this.publicacionesToShow.splice(0),"all"==this.origin){this.filtros={};const o=this.formFiltros.controls.tipoProducto.value;this.localidades.length>0&&(this.filtros.localidades=this.localidades),o&&(this.filtros.tipoProducto=o),console.log("filtro",this.filtros),this.truequesService.getPublicaciones(this.filtros).subscribe({next:e=>{console.log(e),this.publicacionesToShow=e,this.publicacionesToShow.map(c=>{c.parsedImagenes=c.imagenes.split("|")})},complete:()=>this.generateCardList(),error:()=>this.loading=!1})}else"myPublicaciones"==this.origin?this.truequesService.getMisPublicaciones().subscribe({next:o=>{console.log(o),this.publicacionesToShow=o,this.publicacionesToShow.map(e=>{e.parsedImagenes=e.imagenes.split("|")})},complete:()=>{this.publicacionesToShow.length>0?this.truequesService.getTruequesParticular(this.publicacionesToShow[0].particularDTO.idParticular).subscribe({next:o=>{this.trueques=o},complete:()=>this.generateCardList()}):this.loading=!1},error:()=>this.loading=!1}):this.logisticaService.obtenerMisOrdenes("publicaciones").subscribe({next:o=>{o.length>0&&(this.userOrders=o),this.comprasService.getMyCompras().subscribe({next:e=>{console.log(e);for(const c of e)c.publicacionDTO.idCompra=c.idCompra,c.publicacionDTO.estadoCompra=c.estadoCompra,this.publicacionesToShow.push(c.publicacionDTO);this.publicacionesToShow.map(c=>{c.parsedImagenes=c.imagenes.split("|")})},complete:()=>this.generateCardList(),error:()=>this.loading=!1})}})}generateCardList(){this.publicacionesCardList.splice(0),this.publicacionesToShow.sort((o,e)=>new Date(e.fechaPublicacion).getTime()-new Date(o.fechaPublicacion).getTime());const t=[];for(const o of this.publicacionesToShow){let e,c;if("CERRADA"==o.estadoPublicacion){const m=this.trueques.find(d=>"APROBADO"==d.estadoTrueque&&d.publicacionDTOpropuesta.idPublicacion==o.idPublicacion);if(null!=m)e=m.publicacionDTOorigen.idPublicacion;else{const d=this.trueques.find(f=>"APROBADO"==f.estadoTrueque&&f.publicacionDTOorigen.idPublicacion==o.idPublicacion);d&&(c=d.publicacionDTOpropuesta.idPublicacion)}}const p=this.userOrders.some(m=>m.publicacionId==o.idPublicacion);t.push({id:o.idPublicacion,imagen:o.parsedImagenes?o.parsedImagenes[0]:"no_image",titulo:o.titulo,valorPrincipal:`${this.currencyPipe.transform(o.valorTruequeMin)} - ${this.currencyPipe.transform(o.valorTruequeMax)}`,valorSecundario:o.particularDTO.accessToken&&o.precioVenta?`${this.currencyPipe.transform(o.precioVenta)}`:void 0,fecha:o.fechaPublicacion,usuario:{id:o.particularDTO.usuarioDTO.idUsuario,imagen:o.particularDTO.usuarioDTO.avatar,nombre:o.particularDTO.nombre+" "+o.particularDTO.apellido,puntaje:o.particularDTO.puntaje,localidad:o.particularDTO.direcciones[0].localidad},action:e||c?"trueque":"myPublicaciones"==this.origin?"list":"access",idAuxiliar:e||(c?o.idPublicacion:o.idCompra?o.idCompra:void 0),buttons:this.getButtonsForCard(o,!!e||!!c,p),estado:"myPublicaciones"==this.origin?o.estadoPublicacion:o.estadoCompra?o.estadoCompra:void 0,codigo:o.idCompra?"Compra":"all"!=this.origin&&o.vendido?"Venta":"Publicaci\xf3n",estadoAux:o.estadoEnvio})}this.publicacionesCardList=t,this.filteredPublicacionesCardList=this.publicacionesCardList,this.loading=!1}getButtonsForCard(t,o=!1,e=!1){if("myPublicaciones"!=this.origin||t.idCompra||t.estadoEnvio)return"myCompras"==this.origin?(console.log(t),"RECIBIDA"==t.estadoEnvio?[]:e?[{name:"Ver env\xedo",icon:"local_shipping",color:"info",status:"INFO",action:"ver_envio"}]:[{name:"Configurar env\xedo",icon:"local_shipping",color:"info",status:"INFO",action:"configurar_envio"}]):[];{const c=[{name:o?"Ver trueque":"\xbfD\xf3nde lo propuse?",icon:"info",color:"primary",status:"INFO",action:o?"navigate":"list"}];return"ABIERTA"==t.estadoPublicacion&&c.push({name:"Cerrar publicaci\xf3n",icon:"close",color:"warn",status:"CERRADA",action:"change_status"}),c}}limpiarFiltros(){this.formFiltros.reset(),this.localidades=[],this.filtrarPublicaciones()}getLocalidades(){fetch("https://apis.datos.gob.ar/georef/api/localidades?orden=id&provincia=02&max=50&campos=nombre").then(o=>o.json()).then(o=>{for(const e of o.localidades)this.allLocalidades.push(e.nombre)}).catch(o=>console.error(o))}add(t){const o=(t.value||"").trim();o&&this.allLocalidades.some(e=>e.toUpperCase()==o.toUpperCase())&&this.localidades.push(o),t.chipInput.clear(),this.formFiltros.controls.localidad.setValue(null),console.log("add",this.formFiltros.controls.localidad.value)}remove(t){const o=this.localidades.indexOf(t);o>=0&&this.localidades.splice(o,1)}selected(t){this.localidades.push(t.option.viewValue),this.formFiltros.controls.localidad.setValue("")}_filterLocalidad(t){const o=t.toLowerCase();return this.allLocalidades.filter(e=>e.toLowerCase().includes(o))}filterByStatus(t){const o="open"==t.value?"ABIERTA":"closed"==t.value?"CERRADA":["ABIERTA","CERRADA"];this.filteredPublicacionesCardList=this.publicacionesCardList.filter(e=>e.estado&&o.includes(e.estado))}}return n.\u0275fac=function(t){return new(t||n)(i.Y36(h.F0),i.Y36(Z.e),i.Y36(r.qu),i.Y36(M.k),i.Y36(y.x),i.Y36(I.x),i.Y36(L.K),i.Y36(u.H9),i.Y36(w.C))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-trueque"]],decls:18,vars:9,consts:[[3,"title"],["id","main-publicaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","",2,"min-width","255px"],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed","disabled"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","","class","bg-transparent accordion-header-button",4,"ngIf"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"row"],[3,"loading"],["style","text-align: center;",4,"ngIf"],["app","publicaciones",3,"cardList","statusChanged","modalClosed",4,"ngIf"],["class","floating-button-container",4,"ngIf"],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],[2,"width","20px"],["id","form-filtros",3,"formGroup",4,"ngIf"],["style","min-width: 210px;",4,"ngIf"],[4,"ngIf"],["id","form-filtros",3,"formGroup"],["appearance","outline",1,"example-chip-list"],["aria-label","Localidad"],["chipGrid",""],[3,"matTooltip","removed",4,"ngFor","ngForOf"],["placeholder","Localidad...","formControlName","localidad","matInput","",3,"matChipInputFor","matAutocomplete","matChipInputTokenEnd"],["localidadInput",""],[3,"optionSelected"],["autoLocalidad","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline"],["formControlName","tipoProducto"],[2,"text-align","center"],["mat-fab","","extended","","color","primary",3,"click"],["mat-fab","","extended","",2,"background-color","white",3,"click"],[3,"matTooltip","removed"],["matChipRemove",""],[2,"height","16px"],[3,"value"],[2,"min-width","210px"],["value","all",2,"display","flex","flex-direction","column",3,"change"],["value","all"],["value","open"],["value","closed"],["app","publicaciones",3,"cardList","statusChanged","modalClosed"],[1,"floating-button-container"],["mat-fab","","color","primary","aria-label","Agregar Publicaci\xf3n","matTooltip","Agregar Publicaci\xf3n","matTooltipPosition","before",3,"click"]],template:function(t,o){1&t&&(i._UZ(0,"app-header",0),i.TgZ(1,"div",1)(2,"div",2)(3,"div",3,4)(5,"div",5,6)(7,"h2",7),i.YNc(8,R,6,0,"button",8),i.YNc(9,Y,6,0,"button",8),i.qZA(),i.TgZ(10,"div",9)(11,"div",10),i.YNc(12,z,3,3,"ng-template"),i.qZA()()()()(),i.TgZ(13,"div",11),i._UZ(14,"app-spinner",12),i.YNc(15,$,2,0,"div",13),i.YNc(16,W,1,1,"app-deck",14),i.qZA(),i.YNc(17,X,4,0,"div",15),i.qZA()),2&t&&(i.Q6J("title","all"==o.origin?"Publicaciones":"myPublicaciones"==o.origin?"Mis Publicaciones":"Mis Compras"),i.xp6(5),i.Q6J("collapsed",!1)("disabled",o.screenWidth>768),i.xp6(3),i.Q6J("ngIf","myCompras"!=o.origin),i.xp6(1),i.Q6J("ngIf","myCompras"==o.origin),i.xp6(5),i.Q6J("loading",o.loading),i.xp6(1),i.Q6J("ngIf",0==o.filteredPublicacionesCardList.length&&!o.loading),i.xp6(1),i.Q6J("ngIf",o.filteredPublicacionesCardList.length>0&&!o.loading),i.xp6(1),i.Q6J("ngIf","myCompras"!=o.origin))},dependencies:[u.sg,u.O5,C.KE,C.hX,F.Hw,J.Nt,U.cs,S.gD,D.ey,P.XC,P.ZL,g.RA,g.oH,g.qH,g.z3,E.gM,_.VQ,_.U0,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,l.fD,l.QQ,l.VE,l.I,l.fA,l.ud,N.G,q.O,Q.o,u.Ov],styles:["#main-publicaciones[_ngcontent-%COMP%]{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]{padding:10px 0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]{margin:0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]   .accordion-header-button[_ngcontent-%COMP%]{height:40px;font-size:14px;padding:10px;display:flex;justify-content:space-between}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]{display:flex;flex-direction:column}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:100%;padding:5px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 5px;height:36px;font-size:12px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros.localidad-row[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr!important}#main-publicaciones[_ngcontent-%COMP%]   .floating-button-container[_ngcontent-%COMP%]{position:fixed;right:25px;bottom:40px;z-index:999}[_nghost-%COMP%]     .mdc-evolution-chip-set__chips{max-width:100%}[_nghost-%COMP%]     .mat-mdc-standard-chip .mdc-evolution-chip__cell--primary, [_nghost-%COMP%]     .mat-mdc-standard-chip .mdc-evolution-chip__action--primary, [_nghost-%COMP%]     .mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:hidden}@media (min-width: 768px){.accordion-button[_ngcontent-%COMP%]:after{display:none}}@media (min-width: 0px) and (max-width: 768px){#main-publicaciones[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]}),n})()}];let ii=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[h.Bz.forChild(k),h.Bz]}),n})();var oi=a(9433),ti=a(9499),ei=a(4466);let ni=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({providers:[u.H9],imports:[u.ez,ii,oi.q,l.IJ,ti.O,ei.m]}),n})()}}]);