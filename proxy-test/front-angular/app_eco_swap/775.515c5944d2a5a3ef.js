"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[775],{8775:(K,h,a)=>{a.r(h),a.d(h,{PublicacionModule:()=>W});var p=a(4755),u=a(1531),v=a(5226),l=a.n(v),d=a(5580),i=a(2223),m=a(2777),T=a(1728),b=a(3949),f=a(9229);function P(t,c){if(1&t&&(i.TgZ(0,"div",8)(1,"h3"),i._uU(2,"Vas a intercambiar por:"),i.qZA(),i.TgZ(3,"div",9),i._UZ(4,"app-card",10),i.qZA()()),2&t){const e=i.oxw(2);i.xp6(4),i.Q6J("cardData",e.cardPublicacionOrigen)}}function C(t,c){if(1&t){const e=i.EpF();i.TgZ(0,"div",11)(1,"h3",12),i._uU(2,"Seleccion\xe1 una de tus publicaciones para intercambiar!"),i.qZA(),i.TgZ(3,"div",13)(4,"app-deck",14),i.NdJ("cardSelected",function(o){i.CHM(e);const s=i.oxw(2);return i.KtG(s.selectCard(o))}),i.qZA()()()}if(2&t){const e=i.oxw(2);i.xp6(4),i.Q6J("cardList",e.publicacionesCardList)("fixedPageSize",1)("smallWidth",!0)}}function x(t,c){1&t&&(i.TgZ(0,"div"),i._uU(1,"No ten\xe9s publicaciones a\xfan! Cre\xe1 una para poder hacer intercambios"),i.qZA())}function O(t,c){if(1&t&&(i.TgZ(0,"div",4),i.YNc(1,P,5,1,"div",5),i.YNc(2,C,5,3,"div",6),i.YNc(3,x,2,0,"div",7),i.qZA()),2&t){const e=i.oxw();i.xp6(1),i.Q6J("ngIf",e.cardPublicacionOrigen),i.xp6(1),i.Q6J("ngIf",e.publicacionesCardList.length>0),i.xp6(1),i.Q6J("ngIf",0==e.publicacionesCardList.length)}}let _=(()=>{class t{constructor(e,n,o){this.data=e,this.truequeService=n,this.dialogRef=o,this.imagenPublicacion="",this.loading=!1,this.misPublicaciones=[],this.publicacionesCardList=[],console.log(e),this.publicacionOrigen=e.publicacion,this.cardPublicacionOrigen={id:this.publicacionOrigen.idPublicacion,imagen:this.publicacionOrigen.parsedImagenes?this.publicacionOrigen.parsedImagenes[0]:"no_image",titulo:this.publicacionOrigen.titulo,valorPrincipal:`$${this.publicacionOrigen.valorTruequeMin} - $${this.publicacionOrigen.valorTruequeMax}`,fecha:this.publicacionOrigen.fechaPublicacion,usuario:{imagen:"assets/perfiles/perfiles-17.jpg",nombre:this.publicacionOrigen.particularDTO.nombre+" "+this.publicacionOrigen.particularDTO.apellido,puntaje:this.publicacionOrigen.particularDTO.puntaje,localidad:this.publicacionOrigen.particularDTO.direcciones[0].localidad},action:"detail",buttons:[],estado:this.publicacionOrigen.estadoTrueque},this.getMisPublicaciones(),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}getMisPublicaciones(){this.truequeService.getMisPublicacionesForTrueque(this.publicacionOrigen.idPublicacion).subscribe({next:e=>{console.log(e),this.misPublicaciones=e,this.misPublicaciones.map(n=>{n.parsedImagenes=n.imagenes.split("|")})},error:e=>{console.log(e)},complete:()=>this.parsePublicaciones()})}parsePublicaciones(){this.publicacionesCardList.splice(0);for(const e of this.misPublicaciones)this.publicacionesCardList.push({id:e.idPublicacion,imagen:e.parsedImagenes?e.parsedImagenes[0]:"no_image",titulo:e.titulo,valorPrincipal:`$${e.valorTruequeMin} - $${e.valorTruequeMax}`,fecha:e.fechaPublicacion,usuario:{imagen:"assets/perfiles/perfiles-17.jpg",nombre:e.particularDTO.nombre+" "+e.particularDTO.apellido,puntaje:e.particularDTO.puntaje,localidad:e.particularDTO.direcciones[0].localidad},action:"select",buttons:[],estado:e.estadoTrueque})}getImage(e){return this.truequeService.getImagen(e)}selectCard(e){this.cardSelected=e}solicitarTrueque(){this.cardSelected&&this.truequeService.crearTrueque(this.publicacionOrigen.idPublicacion,this.cardSelected).subscribe({next:e=>{console.log(e),l().fire("\xa1Trueque creado!","Se solicit\xf3 el intercambio, solo falta que lo acepten!","success").then(({isConfirmed:n})=>{this.dialogRef.close(n)})}})}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(d.WI),i.Y36(m.x),i.Y36(d.so))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-trocar-modal"]],decls:6,vars:2,consts:[["id","main-trocar",4,"ngIf"],["id","trocar-buttons"],["mat-fab","","extended","","color","light",3,"click"],["mat-fab","","extended","","color","primary",3,"disabled","click"],["id","main-trocar"],["class","publicacion-origen",4,"ngIf"],["class","mis-publicaciones",4,"ngIf"],[4,"ngIf"],[1,"publicacion-origen"],[2,"transform","scale(0.8)","transform-origin","top","max-height","60vh"],["app","publicaciones",3,"cardData"],[1,"mis-publicaciones"],[2,"text-align","center"],[2,"max-width","98%","transform","scale(0.8)","transform-origin","top","max-height","60vh"],["app","publicaciones",3,"cardList","fixedPageSize","smallWidth","cardSelected"]],template:function(e,n){1&e&&(i.YNc(0,O,4,3,"div",0),i.TgZ(1,"div",1)(2,"button",2),i.NdJ("click",function(){return n.close()}),i._uU(3,"CANCELAR"),i.qZA(),i.TgZ(4,"button",3),i.NdJ("click",function(){return n.solicitarTrueque()}),i._uU(5,"SOLICITAR INTERCAMBIO"),i.qZA()()),2&e&&(i.Q6J("ngIf",!n.loading),i.xp6(4),i.Q6J("disabled",!n.cardSelected))},dependencies:[p.O5,T.cs,b.A,f.o],styles:["#main-trocar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;justify-items:center;align-items:center}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]{margin:10px 0;padding-right:15px;border-right:1px solid grey;text-align:center;width:95%}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;border-radius:10px}#main-trocar[_ngcontent-%COMP%]   .mis-publicaciones[_ngcontent-%COMP%]{overflow:auto;padding:10px}#trocar-buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;justify-items:center;margin:10px;gap:10px}@media (min-width: 0px) and (max-width: 576px){#main-trocar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr!important}#main-trocar[_ngcontent-%COMP%]   .publicacion-origen[_ngcontent-%COMP%]{border-right:none!important;border-bottom:1px solid grey}#main-trocar[_ngcontent-%COMP%]   .mis-publicaciones[_ngcontent-%COMP%]{height:40vh!important}#trocar-buttons[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]}),t})();var M=a(3073),A=a(4377),q=a(5763),I=a(4666),w=a(7876),D=a(4984),S=a(6262);function Z(t,c){if(1&t&&(i.TgZ(0,"div",7),i._UZ(1,"app-card",8),i.qZA()),2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("cardData",e.truequeAceptado[0])}}function y(t,c){if(1&t){const e=i.EpF();i.TgZ(0,"div",4)(1,"div")(2,"app-main-card-publicacion",5),i.NdJ("intercambiarEvent",function(){i.CHM(e);const o=i.oxw();return i.KtG(o.intercambiar())})("comprarEvent",function(){i.CHM(e);const o=i.oxw();return i.KtG(o.comprar())}),i.qZA()(),i.YNc(3,Z,2,1,"div",6),i.qZA()}if(2&t){const e=i.oxw();i.xp6(1),i.Tol(e.userData.isLoggedIn&&1==e.truequeAceptado.length?"col-sm-12 col-md-8":""),i.xp6(1),i.Q6J("publicacion",e.publicacion)("userData",e.userData)("userType",e.userType),i.xp6(1),i.Q6J("ngIf",e.userData.isLoggedIn&&1==e.truequeAceptado.length)}}function E(t,c){1&t&&(i.TgZ(0,"div",11),i._uU(1," Esta publicaci\xf3n no tiene nuevas propuestas a\xfan! "),i.qZA())}function L(t,c){if(1&t){const e=i.EpF();i.TgZ(0,"div")(1,"app-deck",12),i.NdJ("statusChanged",function(){i.CHM(e);const o=i.oxw(2);return i.KtG(o.getTrueques())}),i.qZA()()}if(2&t){const e=i.oxw(2);i.xp6(1),i.Q6J("cardList",e.truequesActivos)("fullScreenWidth",!0)}}function J(t,c){if(1&t&&(i.TgZ(0,"div")(1,"h3",9),i._uU(2," Historial de Trueques "),i.qZA(),i._UZ(3,"app-deck",13),i.qZA()),2&t){const e=i.oxw(2);i.xp6(3),i.Q6J("cardList",e.historialTrueques)("fullScreenWidth",!0)}}function N(t,c){if(1&t&&(i.TgZ(0,"div")(1,"div")(2,"h3",9),i._uU(3),i.qZA(),i.YNc(4,E,2,0,"div",10),i.YNc(5,L,2,2,"div",3),i.qZA(),i.YNc(6,J,4,2,"div",3),i.qZA()),2&t){const e=i.oxw();i.xp6(3),i.hij(" ","publicacionPropuesta"==e.userType?"Mi Trueque Activo":"Propuestas de Trueque"," "),i.xp6(1),i.Q6J("ngIf",0==e.truequesActivos.length&&!e.loading),i.xp6(1),i.Q6J("ngIf",e.truequesActivos.length>0),i.xp6(1),i.Q6J("ngIf",e.historialTrueques.length>0)}}const R=[{path:"",component:(()=>{class t{constructor(e,n,o,s,r,g,$,z){this.truequeService=e,this.route=n,this.showErrorService=o,this.auth=s,this.router=r,this.usuarioService=g,this.dialog=$,this.comprasService=z,this.loading=!1,this.publicacionesToShow=[],this.trueques=[],this.userType="notLoggedIn",this.truequeAceptado=[],this.historialTrueques=[],this.truequesActivos=[],this.init=0,this.userData={isSwapper:s.isUserSwapper(),isLoggedIn:s.isUserLoggedIn},this.route.paramMap.subscribe(H=>{this.loading=!0,this.id_publicacion=H.get("id_publicacion"),this.truequeAceptado=[],this.historialTrueques=[],this.truequesActivos=[],0!=this.init&&this.ngAfterViewInit(),this.init++}),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}ngAfterViewInit(){this.userData&&this.userData.isLoggedIn?this.usuarioService.getUserByID(this.auth.getUserID()).subscribe({next:e=>{this.userInfo=e,this.getPublicacion(this.id_publicacion)}}):this.getPublicacion(this.id_publicacion)}getPublicacion(e){this.truequeService.getPublicacion(e).subscribe({next:n=>{this.publicacion=n,this.publicacion.parsedImagenes=this.publicacion.imagenes.split("|"),this.publicacion&&this.userInfo&&this.publicacion.particularDTO.idParticular==this.userInfo.particularDTO.idParticular&&(this.userType="publicacionOrigen"),this.userData.isLoggedIn?this.getTrueques():this.loading=!1},error:n=>{console.log(n),this.loading=!1}})}getTrueques(){this.loading=!0,this.truequesActivos.splice(0),this.historialTrueques.splice(0),this.truequeAceptado.splice(0),this.publicacionesToShow.splice(0),this.truequeService.getTruequesFromPublicacion(this.publicacion.idPublicacion).subscribe({next:e=>{if(this.trueques=e,"publicacionOrigen"!=this.userType&&this.userData.isLoggedIn)this.truequeService.getMisPublicaciones().subscribe({next:n=>{const o=n;for(const s of this.trueques){const r=o.find(g=>s.publicacionDTOpropuesta.idPublicacion==g.idPublicacion);r&&(r.estadoTrueque=s.estadoTrueque.trim(),this.publicacionesToShow.push(r),this.userType="publicacionPropuesta")}this.publicacionesToShow.map(s=>{s.parsedImagenes=s.imagenes.split("|")})},error:()=>{this.loading=!1},complete:()=>{this.parsePublicaciones(),this.loading=!1}});else if("publicacionOrigen"==this.userType&&this.userData.isLoggedIn){for(const n of e)n.publicacionDTOpropuesta.estadoTrueque=n.estadoTrueque.trim(),this.publicacionesToShow.push(n.publicacionDTOpropuesta);this.publicacionesToShow.map(n=>{n.parsedImagenes=n.imagenes.split("|")}),this.parsePublicaciones(),this.loading=!1}},error:()=>{this.loading=!1}})}intercambiar(){if(this.auth.isUserLoggedIn){let e;e=this.screenWidth<576?{data:{publicacion:this.publicacion},width:"70vw",height:"80vh",position:{top:"50vh",left:"50vw"},panelClass:"makeItMiddle"}:{data:{publicacion:this.publicacion},width:"80vw",height:"85vh"},this.dialog.open(_,e).afterClosed().subscribe(o=>{console.log("result trocar",o),o&&this.getTrueques()})}else l().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder intercambiar, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:e})=>{e&&this.router.navigate(["login"])})}comprar(){this.auth.isUserLoggedIn?this.comprasService.comprar(this.publicacion.idPublicacion).subscribe({next:e=>{console.log(e),l().fire({title:"\xa1Ya casi es tuyo!",text:"Termin\xe1 tu compra en Mercado Pago, luego podr\xe1s verla en Mis Compras!",icon:"success",confirmButtonText:"IR A MIS COMPRAS",allowOutsideClick:!1,allowEscapeKey:!1}).then(({isConfirmed:n})=>{n&&window.open(e.initPoint,"_blank")})}}):l().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder comprar, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:e})=>{e&&this.router.navigate(["login"])})}getButtonsForCards(){return"publicacionPropuesta"==this.userType?[{name:"CANCELAR",icon:"close",color:"warn",status:"CANCELADO"}]:"publicacionOrigen"==this.userType?[{name:"ACEPTAR",icon:"check",color:"primary",status:"APROBADO"},{name:"RECHAZAR",icon:"close",color:"warn",status:"RECHAZADO"},{name:"RECIBIDO",icon:"done_all",color:"primary",status:"RECIBIDO"}]:[]}parsePublicaciones(){this.truequesActivos.splice(0),this.historialTrueques.splice(0),this.truequeAceptado.splice(0);for(const e of this.publicacionesToShow){const n={id:e.idPublicacion,imagen:e.parsedImagenes?e.parsedImagenes[0]:"no_image",titulo:e.titulo,valorPrincipal:`$${e.valorTruequeMin} - $${e.valorTruequeMax}`,fecha:e.fechaPublicacion,usuario:{imagen:"assets/perfiles/perfiles-17.jpg",nombre:e.particularDTO.nombre+" "+e.particularDTO.apellido,puntaje:e.particularDTO.puntaje,localidad:e.particularDTO.direcciones[0].localidad},action:"detail",buttons:[],estado:e.estadoTrueque,idAuxiliar:this.trueques.find(o=>o.publicacionDTOpropuesta.idPublicacion==e.idPublicacion)?.idTrueque};"APROBADO"==e.estadoTrueque?this.truequeAceptado.push(n):"PENDIENTE"==e.estadoTrueque&&"ABIERTA"==e.estadoPublicacion?(n.valorSecundario=e.precioVenta?`$${e.precioVenta}`:void 0,n.buttons=this.getButtonsForCards(),this.truequesActivos.push(n)):(n.disabled=!0,this.historialTrueques.push(n))}}hasApprovedTrueque(){return this.publicacionesToShow.filter(e=>"APROBADO"==e.estadoTrueque)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(m.x),i.Y36(u.gz),i.Y36(M.x),i.Y36(A.e),i.Y36(u.F0),i.Y36(q.i),i.Y36(d.uw),i.Y36(I.K))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-publicacion"]],decls:5,vars:3,consts:[["id","main-publicacion",1,"app-main-div"],[3,"loading"],["class","row",4,"ngIf"],[4,"ngIf"],[1,"row"],[3,"publicacion","userData","userType","intercambiarEvent","comprarEvent"],["class","col-sm-12 col-md-4",4,"ngIf"],[1,"col-sm-12","col-md-4"],["app","publicaciones",3,"cardData"],[2,"margin","20px 0 0 5px","font-weight","bold"],["style","text-align: center;",4,"ngIf"],[2,"text-align","center"],["app","publicaciones",3,"cardList","fullScreenWidth","statusChanged"],["app","publicaciones",3,"cardList","fullScreenWidth"]],template:function(e,n){1&e&&(i._UZ(0,"app-header"),i.TgZ(1,"div",0),i._UZ(2,"app-spinner",1),i.YNc(3,y,4,6,"div",2),i.YNc(4,N,7,4,"div",3),i.qZA()),2&e&&(i.xp6(2),i.Q6J("loading",n.loading),i.xp6(1),i.Q6J("ngIf",!n.loading),i.xp6(1),i.Q6J("ngIf",n.userData.isLoggedIn))},dependencies:[p.O5,w.G,D.O,b.A,f.o,S.r],styles:["#main-publicacion[_ngcontent-%COMP%]{padding:2%}#main-publicacion[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .half-card[_ngcontent-%COMP%]{max-width:60%}#main-publicacion[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .half-deck[_ngcontent-%COMP%]{max-width:40%}#main-publicacion[_ngcontent-%COMP%]   .donacion-example-header-image[_ngcontent-%COMP%]{background-image:url(perfiles-17.f67e69cf999cd190.jpg);background-size:cover}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;gap:1rem}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:65px;margin:5px;border-radius:5px;box-shadow:2px 2px 5px var(--dark-grey)}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]{display:flex;flex-direction:column}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:5px auto;width:150px}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .aprobada[_ngcontent-%COMP%]{color:var(--success);font-weight:500}#main-publicacion[_ngcontent-%COMP%]   .donacion-card-content[_ngcontent-%COMP%]   .rechazada[_ngcontent-%COMP%]{color:var(--warn)}@media (min-width: 0px) and (max-width: 576px){.card-content[_ngcontent-%COMP%], .donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr!important}}"]}),t})()}];let Y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[u.Bz.forChild(R),u.Bz]}),t})();var B=a(6058),Q=a(3148),U=a(9499),j=a(4466),F=a(6012);let W=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[p.ez,Y,B.q,Q.IJ,U.O,j.m,F.QW]}),t})()}}]);