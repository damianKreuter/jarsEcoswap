"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[242],{6242:(ii,h,a)=>{a.r(h),a.d(h,{PublicacionesModule:()=>k});var p=a(4755),f=a(1531),_=a(8675),x=a(4004),T=a(5226),O=a.n(T),i=a(2223),A=a(4377),l=a(9401),M=a(4893),Z=a(3073),L=a(2777),y=a(4666),b=a(9114),I=a(430),F=a(9609),w=a(1728),J=a(787),S=a(1217),C=a(8995),m=a(6996),U=a(3649),P=a(4867),r=a(3148),D=a(7876),N=a(4984),Q=a(9229);function R(e,c){if(1&e){const t=i.EpF();i.TgZ(0,"mat-chip-row",36),i.NdJ("removed",function(){const s=i.CHM(t).$implicit,d=i.oxw(4);return i.KtG(d.remove(s))}),i._uU(1),i.TgZ(2,"button",37)(3,"mat-icon",38),i._uU(4,"cancel"),i.qZA()()()}if(2&e){const t=c.$implicit;i.Q6J("matTooltip",t),i.xp6(1),i.hij(" ",t," "),i.xp6(1),i.uIk("aria-label","eliminar "+t)}}function B(e,c){if(1&e&&(i.TgZ(0,"mat-option",39),i._uU(1),i.qZA()),2&e){const t=c.$implicit;i.Q6J("value",t),i.xp6(1),i.hij(" ",t," ")}}function Y(e,c){if(1&e&&(i.TgZ(0,"mat-option",39),i._uU(1),i.qZA()),2&e){const t=c.$implicit;i.Q6J("value",t.nombre),i.xp6(1),i.hij(" ",t.descripcion," ")}}function E(e,c){if(1&e){const t=i.EpF();i.TgZ(0,"form",21)(1,"mat-form-field",22)(2,"mat-label"),i._uU(3,"Localidades"),i.qZA(),i.TgZ(4,"mat-chip-grid",23,24),i.YNc(6,R,5,3,"mat-chip-row",25),i.TgZ(7,"input",26,27),i.NdJ("matChipInputTokenEnd",function(n){i.CHM(t);const s=i.oxw(3);return i.KtG(s.add(n))}),i.qZA()(),i.TgZ(9,"mat-autocomplete",28,29),i.NdJ("optionSelected",function(n){i.CHM(t);const s=i.MAs(8);return i.oxw(3).selected(n),i.KtG(s.value="")}),i.YNc(11,B,2,2,"mat-option",30),i.ALo(12,"async"),i.qZA()(),i.TgZ(13,"mat-form-field",31)(14,"mat-label"),i._uU(15,"Tipo del Producto"),i.qZA(),i.TgZ(16,"mat-select",32),i.YNc(17,Y,2,2,"mat-option",30),i.qZA()(),i.TgZ(18,"div",33)(19,"button",34),i.NdJ("click",function(){i.CHM(t);const n=i.oxw(3);return i.KtG(n.filtrarPublicaciones())}),i._uU(20,"FILTRAR"),i.qZA(),i.TgZ(21,"button",35),i.NdJ("click",function(){i.CHM(t);const n=i.oxw(3);return i.KtG(n.limpiarFiltros())}),i._uU(22,"LIMPIAR"),i.qZA()()()}if(2&e){const t=i.MAs(5),o=i.MAs(10),n=i.oxw(3);i.Q6J("formGroup",n.formFiltros),i.xp6(6),i.Q6J("ngForOf",n.localidades),i.xp6(1),i.Q6J("matChipInputFor",t)("matAutocomplete",o),i.xp6(4),i.Q6J("ngForOf",i.lcZ(12,6,n.filteredLocalidades)),i.xp6(6),i.Q6J("ngForOf",n.tipos_productos)}}function q(e,c){if(1&e){const t=i.EpF();i.TgZ(0,"div",40)(1,"mat-radio-group",41),i.NdJ("change",function(n){i.CHM(t);const s=i.oxw(3);return i.KtG(s.filterByStatus(n))}),i.TgZ(2,"mat-radio-button",42),i._uU(3,"Todas"),i.qZA(),i.TgZ(4,"mat-radio-button",43),i._uU(5,"Abiertas"),i.qZA(),i.TgZ(6,"mat-radio-button",44),i._uU(7,"Cerradas"),i.qZA()()()}}function G(e,c){if(1&e&&(i.YNc(0,E,23,8,"form",19),i.YNc(1,q,8,0,"div",20)),2&e){const t=i.oxw(2);i.Q6J("ngIf","all"==t.origin),i.xp6(1),i.Q6J("ngIf","myPublicaciones"==t.origin)}}function j(e,c){if(1&e&&(i.TgZ(0,"div",10,11)(2,"div",12,13)(4,"h2",14)(5,"button",15)(6,"mat-icon"),i._uU(7,"tune"),i.qZA(),i.TgZ(8,"span",16),i._uU(9,"Filtros"),i.qZA()()(),i.TgZ(10,"div",17)(11,"div",18),i.YNc(12,G,2,2,"ng-template"),i.qZA()()()()),2&e){const t=i.oxw();i.xp6(2),i.Q6J("collapsed",!1)("disabled",t.screenWidth>768)}}function H(e,c){1&e&&(i.TgZ(0,"div",33),i._uU(1,"No hay publicaciones para mostrar"),i.qZA())}function $(e,c){if(1&e&&i._UZ(0,"app-deck",45),2&e){const t=i.oxw();i.Q6J("cardList",t.filteredPublicacionesCardList)}}const V=[{path:"",component:(()=>{class e{constructor(t,o,n,s,d,u,g){this.router=t,this.auth=o,this.fb=n,this.productosService=s,this.showErrorService=d,this.truequesService=u,this.comprasService=g,this.origin="all",this.tipos_productos=[],this.loading=!0,this.publicacionesToShow=[],this.localidades=[],this.allLocalidades=[],this.publicacionesCardList=[],this.filteredPublicacionesCardList=[],this.trueques=[],this.formFiltros=n.group({fundacion:[""],localidad:[""],tipoProducto:[""]}),"/mis-publicaciones"==t.url&&(this.origin="myPublicaciones"),"/mis-compras"==t.url&&(this.origin="myCompras"),this.filteredLocalidades=this.formFiltros.controls.localidad.valueChanges.pipe((0,_.O)(""),(0,x.U)(v=>v?this._filterLocalidad(v):this.allLocalidades.slice())),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}ngOnInit(){this.getTiposProductos(),this.getLocalidades(),this.filtrarPublicaciones()}addPublicacion(){this.auth.isUserLoggedIn?this.router.navigate(["form-publicacion"]):O().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder crear una publicaci\xf3n, ten\xe9s que usar tu cuenta.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:t})=>{t&&this.router.navigate(["login"])})}getTiposProductos(){this.productosService.getTiposProductos().subscribe({next:t=>this.tipos_productos=t,error:t=>console.error("error",t)})}filtrarPublicaciones(){if(this.loading=!0,"all"==this.origin){this.filtros={};const t=this.formFiltros.controls.tipoProducto.value;this.localidades.length>0&&(this.filtros.localidades=this.localidades),t&&(this.filtros.tipoProducto=t),console.log("filtro",this.filtros),this.truequesService.getPublicaciones(this.filtros).subscribe({next:o=>{console.log(o),this.publicacionesToShow=o,this.publicacionesToShow.map(n=>{n.parsedImagenes=n.imagenes.split("|")})},complete:()=>this.generateCardList(),error:()=>this.loading=!1})}else"myPublicaciones"==this.origin?this.truequesService.getMisPublicaciones().subscribe({next:t=>{console.log(t),this.publicacionesToShow=t,this.publicacionesToShow.map(o=>{o.parsedImagenes=o.imagenes.split("|")})},complete:()=>{this.publicacionesToShow.length>0?this.truequesService.getTruequesParticular(this.publicacionesToShow[0].particularDTO.idParticular).subscribe({next:t=>{this.trueques=t},complete:()=>this.generateCardList()}):this.loading=!1},error:()=>this.loading=!1}):this.comprasService.getMyCompras().subscribe({next:t=>{console.log(t);for(const o of t)o.publicacionDTO.idCompra=o.idCompra,o.publicacionDTO.estadoCompra=o.estadoCompra,this.publicacionesToShow.push(o.publicacionDTO);this.publicacionesToShow.map(o=>{o.parsedImagenes=o.imagenes.split("|")})},complete:()=>this.generateCardList(),error:()=>this.loading=!1})}generateCardList(){this.publicacionesCardList.splice(0);const t=[];for(const o of this.publicacionesToShow){let n,s;if("CERRADA"==o.estadoPublicacion){const d=this.trueques.find(u=>"APROBADO"==u.estadoTrueque&&u.publicacionDTOpropuesta.idPublicacion==o.idPublicacion);if(null!=d)n=d.publicacionDTOorigen.idPublicacion;else{const u=this.trueques.find(g=>"APROBADO"==g.estadoTrueque&&g.publicacionDTOorigen.idPublicacion==o.idPublicacion);u&&(s=u.publicacionDTOpropuesta.idPublicacion)}}t.push({id:o.idPublicacion,imagen:o.parsedImagenes?o.parsedImagenes[0]:"no_image",titulo:o.titulo,valorPrincipal:`$${o.valorTruequeMin} - $${o.valorTruequeMax}`,valorSecundario:o.particularDTO.accessToken&&o.precioVenta?`$${o.precioVenta}`:void 0,fecha:o.fechaPublicacion,usuario:{id:o.particularDTO.usuarioDTO.idUsuario,imagen:o.particularDTO.usuarioDTO.avatar,nombre:o.particularDTO.nombre+" "+o.particularDTO.apellido,puntaje:o.particularDTO.puntaje,localidad:o.particularDTO.direcciones[0].localidad},action:n||s?"trueque":"myPublicaciones"==this.origin?"list":"access",idAuxiliar:n||(s?o.idPublicacion:o.idCompra?o.idCompra:void 0),buttons:this.getButtonsForCard(o,!!n||!!s),estado:"myPublicaciones"==this.origin?o.estadoPublicacion:o.estadoCompra?o.estadoCompra:void 0,codigo:o.idCompra?"Compra":"Publicaci\xf3n"})}this.publicacionesCardList=t,this.filteredPublicacionesCardList=this.publicacionesCardList,this.loading=!1}getButtonsForCard(t,o=!1){return"myPublicaciones"==this.origin?[{name:o?"Ver trueque":"\xbfD\xf3nde lo propuse?",icon:"info",color:"primary",status:"INFO"}]:"myCompras"==this.origin?[{name:"Configurar env\xedo",icon:"local_shipping",color:"info",status:"INFO"}]:[]}limpiarFiltros(){this.formFiltros.reset(),this.localidades=[],this.filtrarPublicaciones()}getLocalidades(){fetch("https://apis.datos.gob.ar/georef/api/localidades?orden=id&provincia=02&max=50&campos=nombre").then(o=>o.json()).then(o=>{for(const n of o.localidades)this.allLocalidades.push(n.nombre)}).catch(o=>console.error(o))}add(t){const o=(t.value||"").trim();o&&this.allLocalidades.some(n=>n.toUpperCase()==o.toUpperCase())&&this.localidades.push(o),t.chipInput.clear(),this.formFiltros.controls.localidad.setValue(null),console.log("add",this.formFiltros.controls.localidad.value)}remove(t){const o=this.localidades.indexOf(t);o>=0&&this.localidades.splice(o,1)}selected(t){this.localidades.push(t.option.viewValue),this.formFiltros.controls.localidad.setValue("")}_filterLocalidad(t){const o=t.toLowerCase();return this.allLocalidades.filter(n=>n.toLowerCase().includes(o))}filterByStatus(t){const o="open"==t.value?"ABIERTA":"closed"==t.value?"CERRADA":["ABIERTA","CERRADA"];this.filteredPublicacionesCardList=this.publicacionesCardList.filter(n=>n.estado&&o.includes(n.estado))}}return e.\u0275fac=function(t){return new(t||e)(i.Y36(f.F0),i.Y36(A.e),i.Y36(l.qu),i.Y36(M.k),i.Y36(Z.x),i.Y36(L.x),i.Y36(y.K))},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-trueque"]],decls:12,vars:5,consts:[[3,"title"],["id","main-publicaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","","style","min-width: 255px;",4,"ngIf"],[1,"row"],[3,"loading"],["style","text-align: center;",4,"ngIf"],["app","publicaciones",3,"cardList",4,"ngIf"],[1,"floating-button-container"],["mat-fab","","color","primary","aria-label","Agregar Publicaci\xf3n","matTooltip","Agregar Publicaci\xf3n","matTooltipPosition","before",3,"click"],["ngbAccordion","",2,"min-width","255px"],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed","disabled"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["id","form-filtros",3,"formGroup",4,"ngIf"],["style","min-width: 210px;",4,"ngIf"],["id","form-filtros",3,"formGroup"],["appearance","outline",1,"example-chip-list"],["aria-label","Localidad"],["chipGrid",""],[3,"matTooltip","removed",4,"ngFor","ngForOf"],["placeholder","Localidad...","formControlName","localidad","matInput","",3,"matChipInputFor","matAutocomplete","matChipInputTokenEnd"],["localidadInput",""],[3,"optionSelected"],["autoLocalidad","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline"],["formControlName","tipoProducto"],[2,"text-align","center"],["mat-fab","","extended","","color","primary",3,"click"],["mat-fab","","extended","",2,"background-color","white",3,"click"],[3,"matTooltip","removed"],["matChipRemove",""],[2,"height","16px"],[3,"value"],[2,"min-width","210px"],["value","all",2,"display","flex","flex-direction","column",3,"change"],["value","all"],["value","open"],["value","closed"],["app","publicaciones",3,"cardList"]],template:function(t,o){1&t&&(i._UZ(0,"app-header",0),i.TgZ(1,"div",1)(2,"div",2),i.YNc(3,j,13,2,"div",3),i.qZA(),i.TgZ(4,"div",4),i._UZ(5,"app-spinner",5),i.YNc(6,H,2,0,"div",6),i.YNc(7,$,1,1,"app-deck",7),i.qZA(),i.TgZ(8,"div",8)(9,"button",9),i.NdJ("click",function(){return o.addPublicacion()}),i.TgZ(10,"mat-icon"),i._uU(11,"add"),i.qZA()()()()),2&t&&(i.Q6J("title","all"==o.origin?"Publicaciones":"myPublicaciones"==o.origin?"Mis Publicaciones":"Mis Compras"),i.xp6(3),i.Q6J("ngIf","myCompras"!=o.origin),i.xp6(2),i.Q6J("loading",o.loading),i.xp6(1),i.Q6J("ngIf",0==o.filteredPublicacionesCardList.length&&!o.loading),i.xp6(1),i.Q6J("ngIf",o.filteredPublicacionesCardList.length>0&&!o.loading))},dependencies:[p.sg,p.O5,b.KE,b.hX,I.Hw,F.Nt,w.cs,J.gD,S.ey,C.XC,C.ZL,m.RA,m.oH,m.qH,m.z3,U.gM,P.VQ,P.U0,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,r.fD,r.QQ,r.VE,r.I,r.fA,r.ud,D.G,N.O,Q.o,p.Ov],styles:["#main-publicaciones[_ngcontent-%COMP%]{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]{padding:10px 0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]{margin:0}#main-publicaciones[_ngcontent-%COMP%]   .accordion[_ngcontent-%COMP%]   .accordion-item[_ngcontent-%COMP%]   .accordion-header[_ngcontent-%COMP%]   .accordion-header-button[_ngcontent-%COMP%]{height:40px;font-size:14px;padding:10px;display:flex;justify-content:space-between}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]{display:flex;flex-direction:column}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:100%;padding:5px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 5px;height:36px;font-size:12px}#main-publicaciones[_ngcontent-%COMP%]   #form-filtros.localidad-row[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr!important}#main-publicaciones[_ngcontent-%COMP%]   .floating-button-container[_ngcontent-%COMP%]{position:fixed;right:25px;bottom:40px;z-index:999}[_nghost-%COMP%]     .mdc-evolution-chip-set__chips{max-width:100%}[_nghost-%COMP%]     .mat-mdc-standard-chip .mdc-evolution-chip__cell--primary, [_nghost-%COMP%]     .mat-mdc-standard-chip .mdc-evolution-chip__action--primary, [_nghost-%COMP%]     .mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:hidden}@media (min-width: 768px){.accordion-button[_ngcontent-%COMP%]:after{display:none}}@media (min-width: 0px) and (max-width: 768px){#main-publicaciones[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]}),e})()}];let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({imports:[f.Bz.forChild(V),f.Bz]}),e})();var z=a(9433),W=a(9499),X=a(4466);let k=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({imports:[p.ez,K,z.q,r.IJ,W.O,X.m]}),e})()}}]);