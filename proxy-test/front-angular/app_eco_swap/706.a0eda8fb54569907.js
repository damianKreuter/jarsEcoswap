"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[706],{1706:(J,m,a)=>{a.r(m),a.d(m,{DonacionesModule:()=>y});var p=a(4755),h=a(1531),f=a(8988),C=a(8088),D=a(5226),g=a.n(D),n=a(2223),v=a(5580),x=a(8628),O=a(3073),A=a(4303),_=a(430),M=a(1728),r=a(3148),b=a(7876),P=a(9229);function L(s,c){if(1&s){const e=n.EpF();n.TgZ(0,"div",16)(1,"button",17),n.NdJ("click",function(){n.CHM(e);const o=n.oxw(2);return n.KtG(o.selectDonaciones())}),n._uU(2," SELECCIONAR DONACIONES PARA ENVIAR "),n.qZA(),n.TgZ(3,"button",18),n.NdJ("click",function(){n.CHM(e);const o=n.oxw(2);return n.KtG(o.cancelSelect())}),n._uU(4," CANCELAR "),n.qZA(),n.TgZ(5,"button",19),n.NdJ("click",function(){n.CHM(e);const o=n.oxw(2);return n.KtG(o.confirmSelectedCards())}),n._uU(6," CONFIRMAR SELECCI\xd3N "),n.qZA()()}if(2&s){const e=n.oxw(2);n.xp6(1),n.Q6J("disabled",e.selectingMode),n.xp6(2),n.Q6J("disabled",!e.selectingMode),n.xp6(2),n.Q6J("disabled",!e.selectingMode||0==e.selectedCards.length)}}function N(s,c){1&s&&(n.TgZ(0,"div",20),n._uU(1," No ten\xe9s donaciones pendientes de env\xedo! "),n.qZA())}function T(s,c){if(1&s&&(n.YNc(0,L,7,3,"div",14),n.YNc(1,N,2,0,"div",15)),2&s){const e=n.oxw();n.Q6J("ngIf",e.showButtons()),n.xp6(1),n.Q6J("ngIf",!e.showButtons())}}function w(s,c){if(1&s){const e=n.EpF();n.TgZ(0,"div")(1,"app-deck",21),n.NdJ("modalClosed",function(o){n.CHM(e);const i=n.oxw();return n.KtG(i.cardModalClosed(o))})("statusChanged",function(){n.CHM(e);const o=n.oxw();return n.KtG(o.getDonaciones())})("cardSelected",function(o){n.CHM(e);const i=n.oxw();return n.KtG(i.selectCard(o))})("cardUnselected",function(o){n.CHM(e);const i=n.oxw();return n.KtG(i.unselectCard(o))}),n.qZA()()}if(2&s){const e=n.oxw();n.xp6(1),n.Q6J("cardList",e.donacionesCardList)}}function E(s,c){1&s&&(n.TgZ(0,"div",22),n._uU(1," No hay ninguna donaci\xf3n para mostrar! "),n.qZA())}const I=[{path:"",component:(()=>{class s{constructor(e,t,o,i){this.dialog=e,this.donacionesService=t,this.showErrorService=o,this.logisticaService=i,this.donaciones=[],this.donacionesCardList=[],this.loading=!1,this.selectingMode=!1,this.selectedCards=[],this.userOrders=[],this.getDonaciones(),this.screenWidth=window.innerWidth>0?window.innerWidth:screen.width}getDonaciones(){this.loading=!0,this.donaciones.splice(0),this.logisticaService.obtenerMisOrdenes("donaciones").subscribe({next:e=>{e.length>0&&(this.userOrders=e)}}),this.donacionesService.getMisDonaciones().subscribe({next:e=>{e?(this.donaciones=e,this.donaciones.map(t=>{t.idDonacion&&(t.last_status=t.estado),t.imagenes&&(t.parsedImagenes=t.imagenes.split("|"))})):this.showErrorService.show("Error!","No se encontr\xf3 la informaci\xf3n de tus donaciones. Intent\xe1 nuevamente m\xe1s tarde.")},error:e=>{console.log(e),this.loading=!1},complete:()=>this.generateCardList()})}generateCardList(){this.donacionesCardList.splice(0);const e=[];for(const t of this.donaciones){let o="";for(const[u,d]of t.caracteristicaDonacion.entries())0==u?o=d.caracteristica:o+=" - "+d.caracteristica;const i=this.userOrders.some(u=>u.productosADonarDeOrdenList.some(d=>d.idDonacion==t.idDonacion)),l={id:t.idDonacion,imagen:t.parsedImagenes?t.parsedImagenes[0]:"no_image",titulo:t.descripcion,valorPrincipal:`${t.cantidadDonacion} ${1==t.cantidadDonacion?"unidad":"unidades"} de ${t.producto.descripcion}`,valorSecundario:o,fecha:t.fechaDonacion,usuario:{id:t.producto.colectaDTO.fundacionDTO.usuarioDTO.idUsuario,imagen:t.producto.colectaDTO.fundacionDTO.usuarioDTO.avatar,nombre:t.producto.colectaDTO.fundacionDTO.nombre,puntaje:t.producto.colectaDTO.fundacionDTO.puntaje,localidad:t.producto.colectaDTO.fundacionDTO.direcciones[0].localidad},action:"access",buttons:this.getButtonsForCard(t,i),estado:t.estadoDonacion.replace("_"," "),idAuxiliar:t.producto.colectaDTO.idColecta};e.push(l),this.loading=!1}this.donacionesCardList=e}getButtonsForCard(e,t){return"APROBADA"==e.estadoDonacion?t?[{name:"Ver env\xedo",icon:"local_shipping",color:"info",status:"INFO"}]:[{name:"Configurar env\xedo",icon:"local_shipping",color:"info",status:"INFO"},{name:"Llevar en persona",icon:"directions_walk",color:"info",status:"EN_ESPERA"}]:"EN_ESPERA"!=e.estadoDonacion&&"EN_ENVIO"!=e.estadoDonacion&&"RECIBIDA"!=e.estadoDonacion?[{name:"CANCELAR",icon:"close",color:"warn",status:"CANCELADA"}]:[]}selectDonaciones(){g().fire({title:"Configur\xe1 tu env\xedo!",text:"Seleccion\xe1 las tarjetas de tus donaciones haciendo click en ellas, vas a ver que las que seleccionen se pintar\xe1n. Record\xe1 que solo pod\xe9s seleccionar donaciones a una misma colecta. Una vez que termines, clicke\xe1 el bot\xf3n CONFIRMAR SELECCI\xd3N.",icon:"info",confirmButtonText:"\xa1VAMOS!"});const e=this.donacionesCardList;e.map(t=>{const o=this.userOrders.some(i=>i.productosADonarDeOrdenList.some(l=>l.idDonacion==t.id));"APROBADA"!=t.estado||o?t.buttons=[]:(t.action="select",t.codigo="Donaci\xf3n",t.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO"}])}),this.donacionesCardList=e,this.selectingMode=!0}showButtons(){return!!this.donacionesCardList.some(e=>"APROBADA"==e.estado)}selectCard(e){const t=this.donacionesCardList.find(o=>o.id==e);if(t)if(0==this.selectedCards.length){this.colectaParaEnvio=t.idAuxiliar,this.donacionesCardList.map(i=>{i.id==e&&(i.isSelected=!0)}),this.selectedCards.push(t);const o=this.donacionesCardList;o.map(i=>{i.idAuxiliar!=this.colectaParaEnvio?(i.action="detail",i.codigo=void 0,i.buttons=[]):this.selectedCards.includes(t)&&i.id==t.id&&(i.buttons=[{name:"Quitar",icon:"remove",color:"info",status:"INFO"}])}),this.donacionesCardList=o}else this.colectaParaEnvio!=t.idAuxiliar?g().fire("\xa1Colecta distinta!","No pod\xe9s seleccionar distintas colectas para un mismo env\xedo","warning"):(this.selectedCards.push(t),this.donacionesCardList.map(o=>{o.id==t.id&&(o.buttons=[{name:"Quitar",icon:"remove",color:"info",status:"INFO"}])}))}unselectCard(e){if(this.donacionesCardList.find(o=>o.id==e))if(1==this.selectedCards.length){this.colectaParaEnvio=void 0;const o=this.donacionesCardList;o.map(i=>{const l=[...new Set(this.donaciones.map(d=>d.idDonacion))],u=this.userOrders.find(d=>d.productosADonarDeOrdenList.some(F=>l.includes(F.idDonacion)));"APROBADA"!=i.estado||u?(i.action="detail",i.codigo=void 0,i.buttons=[]):(i.action="select",i.codigo="Donaci\xf3n",i.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO"}])}),this.donacionesCardList=o,this.selectedCards=[]}else{const o=this.selectedCards.filter(i=>i.id!=e);this.selectedCards=o,this.donacionesCardList.map(i=>{i.id==e&&(i.action="select",i.codigo="Donaci\xf3n",i.buttons=[{name:"Agregar",icon:"add",color:"info",status:"INFO"}])})}this.donacionesCardList.map(o=>{o.id==e&&(o.isSelected=!1)})}cancelSelect(){this.selectedCards=[],this.selectingMode=!1;const e=this.donacionesCardList;e.map(t=>{const o=this.userOrders.find(i=>i.productosADonarDeOrdenList.some(l=>t.id==l.idDonacion));t.action="detail",t.codigo=void 0,t.buttons="APROBADA"==t.estado&&o?[{name:"Ver env\xedo",icon:"local_shipping",color:"info",status:"INFO"}]:[]}),this.donacionesCardList=e,this.selectedCards=[]}confirmSelectedCards(){const e=this.donaciones.filter(o=>this.selectedCards.some(i=>i.id==o.idDonacion));this.dialog.open(f.o,{maxWidth:"60vw",maxHeight:"70vh",width:"100%",panelClass:"full-screen-modal",data:{cards:e}}).afterClosed().subscribe(o=>{console.log("closed",o),o&&this.getDonaciones()})}zoomImage(e){g().fire({html:`<img src="${e}" style="width: 100%"/>`,showConfirmButton:!1,showCloseButton:!0})}openDialog(){this.dialog.open(C.G,{maxWidth:"70vw",maxHeight:"60vh",height:"100%",width:"100%",panelClass:"full-screen-modal"})}getImage(e){return this.donacionesService.getImagen(e)}cardModalClosed(e){e.result&&this.cancelSelect()}}return s.\u0275fac=function(e){return new(e||s)(n.Y36(v.uw),n.Y36(x.M),n.Y36(O.x),n.Y36(A.C))},s.\u0275cmp=n.Xpm({type:s,selectors:[["app-donaciones"]],decls:18,vars:4,consts:[["title","Mis Donaciones"],["id","main-donaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","",2,"min-width","255px"],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed","disabled"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[4,"ngIf"],["style","margin: 10%; text-align: center;",4,"ngIf"],["class","buttons",4,"ngIf"],["style","min-width: 210px; margin-bottom: 20px; text-align: center;",4,"ngIf"],[1,"buttons"],["mat-fab","","extended","",1,"long-text",3,"disabled","click"],["mat-fab","","extended","",2,"background-color","var(--light-grey)",3,"disabled","click"],["mat-fab","","extended","",2,"background-color","var(--info)",3,"disabled","click"],[2,"min-width","210px","margin-bottom","20px","text-align","center"],["app","donaciones",3,"cardList","modalClosed","statusChanged","cardSelected","cardUnselected"],[2,"margin","10%","text-align","center"]],template:function(e,t){1&e&&(n._UZ(0,"app-header",0),n.TgZ(1,"div",1)(2,"div",2)(3,"div",3,4)(5,"div",5,6)(7,"h2",7)(8,"button",8)(9,"mat-icon"),n._uU(10,"local_shipping"),n.qZA(),n.TgZ(11,"span",9),n._uU(12,"Env\xedo"),n.qZA()()(),n.TgZ(13,"div",10)(14,"div",11),n.YNc(15,T,2,2,"ng-template"),n.qZA()()()()(),n.YNc(16,w,2,1,"div",12),n.YNc(17,E,2,0,"div",13),n.qZA()),2&e&&(n.xp6(5),n.Q6J("collapsed",!1)("disabled",t.screenWidth>768),n.xp6(11),n.Q6J("ngIf",t.donacionesCardList.length>0),n.xp6(1),n.Q6J("ngIf",0==t.donacionesCardList.length))},dependencies:[p.O5,_.Hw,M.cs,r.fD,r.QQ,r.VE,r.I,r.fA,r.ud,b.G,P.o],styles:["#main-donaciones[_ngcontent-%COMP%]{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-donaciones[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{min-width:210px;display:flex;flex-direction:column;align-items:center;gap:15px}#main-donaciones[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .long-text[_ngcontent-%COMP%]{background-color:var(--info)}.donacion-example-header-image[_ngcontent-%COMP%]{background-image:url(perfiles-24.8b8b387b71873795.jpg);background-size:cover}.donacion-card-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;gap:1rem;padding:16px}.donacion-card-content[_ngcontent-%COMP%]   .donacion-aceptada[_ngcontent-%COMP%]{font-weight:700;color:var(--success)}.donacion-card-content[_ngcontent-%COMP%]   .donacion-rechazada[_ngcontent-%COMP%]{font-weight:700;color:var(--warn)}.donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:65px;margin:5px}.donacion-card-content[_ngcontent-%COMP%]   .imagenes[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{cursor:pointer}.donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]{display:flex;align-items:center}.donacion-card-content[_ngcontent-%COMP%]   .donacion-status[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:5px}@media (min-width: 0px) and (max-width: 768px){#main-donaciones[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}@media (min-width: 769px){.long-text[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}}@media (min-width: 768px){.accordion-button[_ngcontent-%COMP%]:after{display:none}}"]}),s})()}];let S=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=n.oAB({type:s}),s.\u0275inj=n.cJS({imports:[h.Bz.forChild(I),h.Bz]}),s})();var R=a(9433),B=a(9499),Z=a(4466);let y=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=n.oAB({type:s}),s.\u0275inj=n.cJS({imports:[p.ez,S,R.q,r.IJ,B.O,Z.m]}),s})()}}]);