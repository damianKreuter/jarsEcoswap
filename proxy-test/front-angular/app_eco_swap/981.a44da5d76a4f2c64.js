"use strict";(self.webpackChunkapp_eco_swap=self.webpackChunkapp_eco_swap||[]).push([[981],{1981:(ao,h,a)=>{a.r(h),a.d(h,{ColectasModule:()=>oo});var d=a(4755),f=a(1531),g=a(8675),v=a(4004),F=a(5226),A=a.n(F),o=a(2223),Z=a(4377),y=a(8628),L=a(5500);const C="URImsUsuarios";let b=(()=>{class e{constructor(t){this.backendService=t}getFundacion(t){return this.backendService.get(C,"fundacion/"+t)}getFundaciones(){return this.backendService.get(C,"fundaciones")}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(L.k))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var l=a(9401),I=a(4893),M=a(3073),x=a(9114),U=a(430),J=a(9609),S=a(1728),w=a(787),N=a(1217),T=a(8995),u=a(6996),Q=a(3649),r=a(3148),Y=a(7876),O=a(4984),P=a(9229);function B(e,c){if(1&e&&(o.TgZ(0,"mat-option",33),o._uU(1),o.qZA()),2&e){const t=c.$implicit;o.Q6J("value",t),o.xp6(1),o.hij(" ",t.nombre," ")}}function j(e,c){if(1&e&&(o.TgZ(0,"mat-option",33),o._uU(1),o.qZA()),2&e){const t=c.$implicit;o.Q6J("value",t.nombre),o.xp6(1),o.hij(" ",t.descripcion," ")}}function G(e,c){if(1&e){const t=o.EpF();o.TgZ(0,"mat-chip-row",34),o.NdJ("removed",function(){const s=o.CHM(t).$implicit,m=o.oxw(3);return o.KtG(m.remove(s))}),o._uU(1),o.TgZ(2,"button",35)(3,"mat-icon",36),o._uU(4,"cancel"),o.qZA()()()}if(2&e){const t=c.$implicit;o.Q6J("matTooltip",t),o.xp6(1),o.hij(" ",t," "),o.xp6(1),o.uIk("aria-label","eliminar "+t)}}function E(e,c){if(1&e&&(o.TgZ(0,"mat-option",33),o._uU(1),o.qZA()),2&e){const t=c.$implicit;o.Q6J("value",t),o.xp6(1),o.hij(" ",t," ")}}function H(e,c){if(1&e){const t=o.EpF();o.TgZ(0,"form",15)(1,"mat-form-field",16)(2,"mat-label"),o._uU(3,"Fundaci\xf3n"),o.qZA(),o._UZ(4,"input",17),o.TgZ(5,"mat-autocomplete",18,19),o.YNc(7,B,2,2,"mat-option",20),o.ALo(8,"async"),o.qZA()(),o.TgZ(9,"mat-form-field",16)(10,"mat-label"),o._uU(11,"Tipo del Producto"),o.qZA(),o.TgZ(12,"mat-select",21),o.YNc(13,j,2,2,"mat-option",20),o.qZA()(),o.TgZ(14,"mat-form-field",22)(15,"mat-label"),o._uU(16,"Localidades"),o.qZA(),o.TgZ(17,"mat-chip-grid",23,24),o.YNc(19,G,5,3,"mat-chip-row",25),o.TgZ(20,"input",26,27),o.NdJ("matChipInputTokenEnd",function(n){o.CHM(t);const s=o.oxw(2);return o.KtG(s.add(n))}),o.qZA()(),o.TgZ(22,"mat-autocomplete",28,29),o.NdJ("optionSelected",function(n){o.CHM(t);const s=o.MAs(21);return o.oxw(2).selected(n),o.KtG(s.value="")}),o.YNc(24,E,2,2,"mat-option",20),o.ALo(25,"async"),o.qZA()(),o.TgZ(26,"div",30)(27,"button",31),o.NdJ("click",function(){o.CHM(t);const n=o.oxw(2);return o.KtG(n.filtrarColectas())}),o._uU(28,"FILTRAR"),o.qZA(),o.TgZ(29,"button",32),o.NdJ("click",function(){o.CHM(t);const n=o.oxw(2);return o.KtG(n.limpiarFiltros())}),o._uU(30,"LIMPIAR"),o.qZA()()()}if(2&e){const t=o.MAs(6),i=o.MAs(18),n=o.MAs(23),s=o.oxw(2);o.Q6J("formGroup",s.formFiltros),o.xp6(4),o.Q6J("matAutocomplete",t),o.xp6(1),o.Q6J("displayWith",s.displayFn),o.xp6(2),o.Q6J("ngForOf",o.lcZ(8,9,s.filteredOptions)),o.xp6(6),o.Q6J("ngForOf",s.tipos_productos),o.xp6(6),o.Q6J("ngForOf",s.localidades),o.xp6(1),o.Q6J("matChipInputFor",i)("matAutocomplete",n),o.xp6(4),o.Q6J("ngForOf",o.lcZ(25,11,s.filteredLocalidades))}}function R(e,c){1&e&&(o.TgZ(0,"div",6,7)(2,"div",8,9)(4,"h2",10)(5,"button",11)(6,"mat-icon"),o._uU(7,"tune"),o.qZA(),o.TgZ(8,"span",12),o._uU(9,"Filtros"),o.qZA()()(),o.TgZ(10,"div",13)(11,"div",14),o.YNc(12,H,31,13,"ng-template"),o.qZA()()()()),2&e&&(o.xp6(2),o.Q6J("collapsed",!1))}function z(e,c){1&e&&(o.TgZ(0,"div",30),o._uU(1,"No hay colectas para mostrar"),o.qZA())}function D(e,c){if(1&e&&o._UZ(0,"app-deck",41),2&e){const t=o.oxw(2);o.Q6J("cardList",t.colectasCardList)}}function V(e,c){if(1&e&&(o.TgZ(0,"div",37),o._UZ(1,"app-spinner",38),o.YNc(2,z,2,0,"div",39),o.YNc(3,D,1,1,"app-deck",40),o.qZA()),2&e){const t=o.oxw();o.xp6(1),o.Q6J("loading",t.loading),o.xp6(1),o.Q6J("ngIf",0==t.colectasCardList.length),o.xp6(1),o.Q6J("ngIf",t.colectasCardList.length>0)}}function K(e,c){if(1&e){const t=o.EpF();o.TgZ(0,"div",42)(1,"button",43),o.NdJ("click",function(){o.CHM(t);const n=o.oxw();return o.KtG(n.addColecta())}),o.TgZ(2,"mat-icon"),o._uU(3,"add"),o.qZA()()()}}const $=[{path:"",component:(()=>{class e{constructor(t,i,n,s,m,to,eo,io){this.router=t,this.auth=i,this.donacionesService=n,this.fundacionesService=s,this.fb=m,this.productosService=to,this.showErrorService=eo,this.datePipe=io,this.isMyColectas=!1,this.colectasToShow=[],this.loading=!0,this.tipos_productos=[],this.optionsFundaciones=[],this.filtros={},this.colectasCardList=[],this.localidades=[],this.allLocalidades=[],"/mis-colectas"==t.url&&(this.isMyColectas=!0),this.formFiltros=m.group({fundacion:[""],localidad:[""],tipoProducto:[""]}),this.filteredOptions=this.formFiltros.controls.fundacion.valueChanges.pipe((0,g.O)(""),(0,v.U)(p=>{const _="string"==typeof p?p:p?.nombre;return _?this._filter(_):this.optionsFundaciones.slice()})),this.userData={isSwapper:i.isUserSwapper()},this.filteredLocalidades=this.formFiltros.controls.localidad.valueChanges.pipe((0,g.O)(""),(0,v.U)(p=>p?this._filterLocalidad(p):this.allLocalidades.slice()))}ngOnInit(){this.getFundaciones(),this.getTiposProductos(),this.getLocalidades(),this.filtrarColectas()}filtrarColectas(){if(this.loading=!0,this.isMyColectas)this.donacionesService.getMisColectas().subscribe({next:t=>{this.colectasToShow=t,console.log(this.colectasToShow)},error:t=>{console.log("error mis colectas",t),this.loading=!1},complete:()=>{this.generateCardList(),this.loading=!1}});else{this.filtros={};const t=this.formFiltros.controls.fundacion.value?this.formFiltros.controls.fundacion.value.idFundacion:void 0,i=this.formFiltros.controls.tipoProducto.value;t&&(this.filtros.idFundacion=t),this.localidades.length>0&&(this.filtros.localidades=this.localidades),i&&(this.filtros.tipoProducto=i),this.donacionesService.getAllColectas(this.filtros).subscribe({next:n=>{this.colectasToShow=n},error:n=>{console.log("error all colectas",n),this.loading=!1},complete:()=>{this.generateCardList(),this.loading=!1}})}}generateCardList(){console.log(this.colectasToShow),this.colectasCardList.splice(0);for(const t of this.colectasToShow){let i="";for(const[n,s]of t.productos.entries())0==n?i=s.descripcion:i+=" - "+s.descripcion;this.colectasCardList.push({id:t.idColecta,imagen:t.imagen,titulo:t.titulo,valorPrincipal:i,fechaString:this.parseVigencia(t),usuario:{imagen:"assets/perfiles/perfiles-24.jpg",nombre:t.fundacionDTO.nombre,puntaje:t.fundacionDTO.puntaje,localidad:t.fundacionDTO.direcciones[0].localidad},action:"access",buttons:[]})}}parseVigencia(t){return t.fechaInicio&&t.fechaFin?"Desde el "+this.datePipe.transform(t.fechaInicio,"dd/MM/yyyy")+" hasta el "+this.datePipe.transform(t.fechaFin,"dd/MM/yyyy"):t.fechaInicio?"A partir del "+this.datePipe.transform(t.fechaInicio,"dd/MM/yyyy"):""}addColecta(){this.auth.isUserLoggedIn?this.router.navigateByUrl("form-colecta"):A().fire({title:"\xa1Necesit\xe1s una cuenta!",text:"Para poder crear una colecta, ten\xe9s que usar la cuenta de una fundaci\xf3n.",icon:"warning",confirmButtonText:"Iniciar sesi\xf3n",showCancelButton:!0,cancelButtonText:"Cancelar"}).then(({isConfirmed:t})=>{t&&this.router.navigate(["login"])})}getFundaciones(){this.fundacionesService.getFundaciones().subscribe(t=>{console.log(t),this.optionsFundaciones=t})}getTiposProductos(){this.productosService.getTiposProductos().subscribe({next:t=>{console.log("productos",t),this.tipos_productos=t},error:t=>{console.error("error",t)},complete:()=>console.info("complete")})}getLocalidades(){fetch("https://apis.datos.gob.ar/georef/api/localidades?orden=id&provincia=02&max=50&campos=nombre").then(i=>i.json()).then(i=>{for(const n of i.localidades)this.allLocalidades.push(n.nombre)}).catch(i=>console.error(i))}limpiarFiltros(){this.formFiltros.reset(),this.localidades=[],this.filtrarColectas()}displayFn(t){return t&&t.nombre?t.nombre:""}_filter(t){const i=t.toLowerCase();return this.optionsFundaciones.filter(n=>n.nombre.toLowerCase().includes(i))}goToColecta(t){this.router.navigateByUrl("colecta/"+t.idColecta)}add(t){const i=(t.value||"").trim();i&&this.allLocalidades.some(n=>n.toUpperCase()==i.toUpperCase())&&this.localidades.push(i),t.chipInput.clear(),this.formFiltros.controls.localidad.setValue(null)}remove(t){const i=this.localidades.indexOf(t);i>=0&&this.localidades.splice(i,1)}selected(t){this.localidades.push(t.option.viewValue),this.formFiltros.controls.localidad.setValue("")}_filterLocalidad(t){const i=t.toLowerCase();return this.allLocalidades.filter(n=>n.toLowerCase().includes(i))}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(f.F0),o.Y36(Z.e),o.Y36(y.M),o.Y36(b),o.Y36(l.qu),o.Y36(I.k),o.Y36(M.x),o.Y36(d.uU))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-colectas"]],decls:6,vars:4,consts:[[3,"title"],["id","main-donaciones",1,"app-main-div"],[1,"dense-3"],["ngbAccordion","",4,"ngIf"],["class","row",4,"ngIf"],["class","floating-button-container",4,"ngIf"],["ngbAccordion",""],["accordion","ngbAccordion"],["ngbAccordionItem","first",3,"collapsed"],["first","ngbAccordionItem"],["ngbAccordionHeader",""],["ngbAccordionButton","",1,"bg-transparent","accordion-header-button"],[2,"margin-left","10px"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["id","form-filtros",3,"formGroup"],["appearance","outline"],["type","text","matInput","","formControlName","fundacion",3,"matAutocomplete"],[3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["formControlName","tipoProducto","panelClass","example-panel"],["appearance","outline",1,"chip-list"],["aria-label","Localidad"],["chipGrid",""],[3,"matTooltip","removed",4,"ngFor","ngForOf"],["placeholder","Localidad...","formControlName","localidad","matInput","",3,"matChipInputFor","matAutocomplete","matChipInputTokenEnd"],["localidadInput",""],[3,"optionSelected"],["autoLocalidad","matAutocomplete"],[2,"text-align","center"],["mat-fab","","extended","","color","accent",3,"click"],["mat-fab","","extended","",2,"background-color","white",3,"click"],[3,"value"],[3,"matTooltip","removed"],["matChipRemove",""],[2,"height","16px"],[1,"row"],[3,"loading"],["style","text-align: center;",4,"ngIf"],["app","colectas",3,"cardList",4,"ngIf"],["app","colectas",3,"cardList"],[1,"floating-button-container"],["mat-fab","","color","accent","aria-label","Agregar Colecta","matTooltip","Agregar Colecta","matTooltipPosition","before",3,"click"]],template:function(t,i){1&t&&(o._UZ(0,"app-header",0),o.TgZ(1,"div",1)(2,"div",2),o.YNc(3,R,13,1,"div",3),o.qZA(),o.YNc(4,V,4,3,"div",4),o.YNc(5,K,4,0,"div",5),o.qZA()),2&t&&(o.Q6J("title",i.isMyColectas?"Mis Colectas":"Colectas"),o.xp6(3),o.Q6J("ngIf",!i.isMyColectas),o.xp6(1),o.Q6J("ngIf",!i.loading),o.xp6(1),o.Q6J("ngIf",!i.userData.isSwapper))},dependencies:[d.sg,d.O5,x.KE,x.hX,U.Hw,J.Nt,S.cs,w.gD,N.ey,T.XC,T.ZL,u.RA,u.oH,u.qH,u.z3,Q.gM,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,r.fD,r.QQ,r.VE,r.I,r.fA,r.ud,Y.G,O.O,P.o,d.Ov],styles:["#main-donaciones{padding:2%;display:grid;grid-template-columns:1fr 5fr;gap:20px}#main-donaciones .accordion{padding:10px 0}#main-donaciones .accordion .accordion-item{border-radius:10px;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}#main-donaciones .accordion .accordion-item .accordion-header{margin:0}#main-donaciones .accordion .accordion-item .accordion-header .accordion-header-button{height:40px;font-size:14px;padding:10px}#main-donaciones #form-filtros{display:flex;flex-direction:column}#main-donaciones #form-filtros mat-form-field{max-width:100%;padding:5px}#main-donaciones #form-filtros button{margin:0 5px;height:36px;font-size:12px}#main-donaciones #form-filtros.localidad-row{grid-template-columns:2fr 1fr!important}#main-donaciones .productos{color:#00f}#main-donaciones .floating-button-container{position:fixed;right:25px;bottom:40px;z-index:999}:host ::ng-deep .mdc-evolution-chip-set__chips{max-width:100%}:host ::ng-deep .mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,:host ::ng-deep .mat-mdc-standard-chip .mdc-evolution-chip__action--primary,:host ::ng-deep .mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:hidden}@media (min-width: 0px) and (max-width: 768px){#main-donaciones{grid-template-columns:1fr!important}}\n"],encapsulation:2}),e})()}];let X=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[f.Bz.forChild($),f.Bz]}),e})();var W=a(6058),k=a(9499),q=a(4466);let oo=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[d.uU],imports:[d.ez,X,W.q,r.IJ,k.O,q.m,l.u5,l.UX]}),e})()}}]);